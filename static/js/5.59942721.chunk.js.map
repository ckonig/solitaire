{"version":3,"sources":["View/Game/BoardGamePad.js","View/Game/BoardKeyboard.js","View/Game/BoardNavigator.js","View/Game/Dealer.js","View/Game/BlinkingComponent.js","View/Game/Card.js","View/Game/Hand.js","View/Game/StackBase.js","View/Game/Foundation.js","View/UI/Header/Clock.tsx","View/UI/Header/Hearts.tsx","View/UI/Header/Hint.tsx","View/UI/Header/Points.tsx","View/UI/Header/ToggleMenu.tsx","View/UI/Header/Undo.tsx","View/UI/Header/Header.tsx","View/UI/Menu.tsx","View/Game/Stock.js","View/Game/Tableau.js","View/Game/Waste.js","View/Game/Board.tsx","View/UI/EndScreen.js","Model/Business/Blinker.ts","Model/Business/Tableau.ts","Model/Business/Dealer.ts","Model/Business/Dispatcher.ts","Model/Game/Focus.ts","Model/Game/BasicStack.js","Model/Game/HandHoldingStack.js","Model/Game/Foundation.js","Model/Business/Foundation.ts","Model/Game/Rating.js","Model/Game/TimeMachine.js","Model/Game/Game.js","Model/Game/Hand.ts","Model/Business/Navigator.ts","Model/Game/Settings.ts","Model/Game/Stock.js","Model/Business/Stock.ts","Model/Business/Waste.ts","Model/Business/Suggestions.ts","Model/Game/Tableau.ts","Model/Game/Waste.js","Model/Model.ts","View/Game/BoardWrap.tsx"],"names":["BoardGamePad","props","state","React","useContext","GlobalContext","player","BoardContext","isGamePadDriven","settings","launchSettings","inputMode","isSinglePlayer","boardMode","switchToGamePad","ctx","focus","isKeyBoard","GamePad","gamepadIndex","players","inputLayout","onLeft","onRight","onUp","onDown","onAction","onCancel","onHint","onUndo","onPause","onMenu","BoardKeyboard","isKeyboardDriven","layout","Universal","getKeyboardLayout","switchToKeyboard","Keyboard","BoardNavigator","updateContext","updateGameContext","replaceContext","paused","PauseContext","before","x","navigator","currentIndex","y","z","isPaused","modifier","moveLeft","moveRight","moveUp","moveDown","pressCurrent","hand","stack","length","onClick","isKeyboard","togglePause","suggestionMode","supportsHints","isTemporary","isVisible","isDisabled","enableHint","_state","previous","game","timemachine","popPreviousState","previousStates","rating","penalize","Dealer","timeouts","quickDeal","dealer","isDealt","dealAll","deal","dealt","push","setTimeout","dealOne","useEffect","forEach","timeout","clearTimeout","BlinkingComponent","selector","this","context","blinkFor","unblink","Component","contextType","Card","pause","inputEl","useRef","isFocused","hasCard","model","current","card","e","preventDefault","clientX","clientY","ele","target","className","includes","offsetParent","rect","getBoundingClientRect","position","click","ownerDocument","defaultView","pageXOffset","pageYOffset","element","names","map","id","label","split","source","isHidden","type","icon","face","style","pointerEvents","onFocus","onBlur","zIndex","offsetTop","top","entropyStyle","offsetLeft","left","getCardStyle","ref","hasSuggestion","isSuggested","suggestion","isSelected","blink","canClick","getClassName","disabled","tabIndex","aria-label","title","Hand","parentModel","index","_c","p","StackBase","classname","hasStack","parent","clickEmpty","children","Foundation","s","foundation","stacks","Stacks","Clock","getElapsed","useState","elapsed","setElapsed","interval","setInterval","started","clearInterval","Hearts","recyclingMode","stock","passes","createString","Array","from","keys","join","getHearts","Hint","Points","points","ToggleMenu","Undo","Math","pow","multiplicator","Header","mode","Menu","restart","NavigationContext","navigation","setNavigation","switchToMenu","menu","pos","screeen","mainMenu","showMenu","onfocus","remaining","allowed","pauses","announcement","keyboardLayout","pausedBy","MenuTitle","MenuTree","MenuButton","sm","SuggestionModes","next","key","setSuggestionMode","val","toggleMainMenu","toggled","EntropyLevels","baseEntropy","lvl","setEntropy","interactionEntropy","skip","_Menu","screen","navigationContext","value","Renderer","InnerRenderer","usePrevious","speed","waste","isFromWaste","putDownHand","addAll","popTop","canRecycle","recycle","Stock","Tableau","tableau","getOffset","i","Waste","drawMode","isHoldingCard","additionalOffset","Board","EndScreen","isEnded","getTimePenalty","end","Date","now","getBonusPoints","getTotal","Blinker","startBlink","registerBlink","stopBlink","dispatchPutDown","wouldAcceptHand","src","registerMove","dispatchPickup","pickUp","popWithFollowing","registerPickup","TableauHidden","tryUncover","uncover","registerUncover","dealingAt","callback","newCard","popOne","isFirst","Dispatcher","clickHandler","getHandler","Focus","keyboard","validSettings","setCard","unsetCard","equals","unsetStack","setStack","BasicStack","getTop","getClickable","filter","HandHoldingStack","getHandContent","setOnClick","sindex","getCurrentAccepted","currentFoundation","acceptedCards","hasMoreThanOneCard","accepts","currentCard","add","putDown","currentAccepted","cards","causeEntropy","min","usedCards","pop","remove","getPreviousUsed","countCards","f","parseInt","reduce","a","b","Object","Suits","suit","getFoundationOrder","color","template","copy","orig","origStack","copyAll","tryDetectEnd","_card","Rating","registerHint","disableHint","currentMove","rateMove","registerRecycle","console","debug","other","undoPenalty","penalty","done","hintPenalty","start","secondsToFinish","trunc","round","on","missPenalty","move","isTableau","obj","substr","isFoundation","TimeMachine","memorable","modified","pushPreviousState","modelEquals","isRequested","popPrevious","stackEquals","every","stacksEqual","Game","c","splice","_onClick","isHoldingKing","isFromCurrentSource","isFromFoundation","isFromTableau","isFromAnyTableau","substring","getTableauIndex","Navigator","rows","getZindex","elem","targets","update","row","j","finishNav","valid","direction","undefined","toggleRow","clickable","pickLast","last","Settings","suggestionModes","get","getHintMode","allSuggestionModes","reverse","setCardProperties","recyclings","isOnTop","result","_position","moveToWaste","recycleWaste","Suggestions","evaluateOptions","disableAllSuggestions","NONE","getUncoverOptions","getPutdownSuggestions","getPickupOptions","FULL","SCORED","onlyUseful","accepted","isMoveOfKingBetweenEmptySlots","isMoveBetweenSimilarParentCards","isNotLoop","foundAny","wasteState","Model","cardIndex","tableauState","filtered","_stack","disableSuggestion","TableauStack","onClickhidden","canUncover","getStack","canPutDown","range","getTableauOrder","indexOf","getCard","stackEntropy","entropy","concat","offset","canAdd","suggestor","withSuggestions","withHandlers","StockHandler","WasteHandler","FoundationHandler","TableauHandler","getInitialState","deck","createContext","BoardProvider","Provider","BoardWrap","setState","render"],"mappings":"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","file":"static/js/5.59942721.chunk.js","sourcesContent":["import { BoardContext } from \"./BoardWrap\";\r\nimport GamePad from \"./GamePad\";\r\nimport GlobalContext from \"../Context\";\r\nimport React from \"react\";\r\n\r\nconst BoardGamePad = (props) => {\r\n    const { state } = React.useContext(GlobalContext);\r\n    const { player } = React.useContext(BoardContext);\r\n    const isGamePadDriven = state.settings.launchSettings.inputMode == \"gamepad\";\r\n    const isSinglePlayer = state.settings.launchSettings.boardMode === \"singleplayer\";\r\n    const switchToGamePad = (ctx) => {\r\n        ctx.focus.isKeyBoard(true);\r\n        if (isSinglePlayer) {\r\n            ctx.settings.launchSettings.inputMode = \"gamepad\";\r\n        }\r\n    };\r\n\r\n    return isSinglePlayer || isGamePadDriven ? (\r\n        <GamePad\r\n            gamepadIndex={state.settings.launchSettings.players[player].inputLayout}\r\n            onLeft={() => props.onLeft && props.onLeft(switchToGamePad)}\r\n            onRight={() => props.onRight && props.onRight(switchToGamePad)}\r\n            onUp={() => props.onUp && props.onUp(switchToGamePad)}\r\n            onDown={() => props.onDown && props.onDown(switchToGamePad)}\r\n            onAction={() => props.onAction && props.onAction(switchToGamePad)}\r\n            onCancel={() => props.onCancel && props.onCancel(switchToGamePad)}\r\n            onHint={() => props.onHint && props.onHint(switchToGamePad)}\r\n            onUndo={() => props.onUndo && props.onUndo()}\r\n            onPause={() => props.onPause && props.onPause(switchToGamePad)}\r\n            onMenu={() => props.onPause && props.onMenu(switchToGamePad)}\r\n        >\r\n            <span></span>\r\n        </GamePad>\r\n    ) : null;\r\n};\r\n\r\nexport default BoardGamePad;\r\n","import { Universal, getKeyboardLayout } from \"./KeyboardLayouts\";\r\n\r\nimport { BoardContext } from \"./BoardWrap\";\r\nimport GlobalContext from \"../Context\";\r\nimport Keyboard from \"./Keyboard\";\r\nimport React from \"react\";\r\n\r\nconst BoardKeyboard = (props) => {\r\n    const { state } = React.useContext(GlobalContext);\r\n    const { player } = React.useContext(BoardContext);\r\n    const isKeyboardDriven = state.settings.launchSettings.inputMode === \"keyboard\";\r\n    const isSinglePlayer = state.settings.launchSettings.boardMode === \"singleplayer\";\r\n    const layout = isSinglePlayer ? Universal : getKeyboardLayout(state.settings.launchSettings.players[player].inputLayout);\r\n\r\n    const switchToKeyboard = (ctx) => {\r\n        ctx.focus.isKeyBoard(true);\r\n        if (isSinglePlayer) {\r\n            ctx.settings.launchSettings.inputMode = \"keyboard\";\r\n        }\r\n    };\r\n\r\n    return isKeyboardDriven || isSinglePlayer ? (\r\n        <Keyboard\r\n            layout={layout}\r\n            onLeft={() => props.onLeft && props.onLeft(switchToKeyboard)}\r\n            onRight={() => props.onRight && props.onRight(switchToKeyboard)}\r\n            onUp={() => props.onUp && props.onUp(switchToKeyboard)}\r\n            onDown={() => props.onDown && props.onDown(switchToKeyboard)}\r\n            onAction={() => props.onAction && props.onAction(switchToKeyboard)}\r\n            onCancel={() => props.onCancel && props.onCancel(switchToKeyboard)}\r\n            onHint={() => props.onHint && props.onHint(switchToKeyboard)}\r\n            onUndo={() => props.onUndo && props.onUndo()}\r\n            onPause={() => props.onPause && props.onPause(switchToKeyboard)}\r\n            onMenu={() => props.onMenu && props.onMenu(switchToKeyboard)}\r\n        />\r\n    ) : null;\r\n};\r\n\r\nexport default BoardKeyboard;\r\n","import { BoardContext } from \"./BoardWrap\";\r\nimport BoardGamePad from \"./BoardGamePad\";\r\nimport BoardKeyboard from \"./BoardKeyboard\";\r\nimport GlobalContext from \"../Context\";\r\nimport PauseContext from \"../PauseContext\";\r\nimport React from \"react\";\r\n\r\nconst BoardNavigator = () => {\r\n    const { state, updateContext, updateGameContext, replaceContext } = React.useContext(GlobalContext);\r\n    const paused = React.useContext(PauseContext);\r\n    const { player } = React.useContext(BoardContext);\r\n    const before = { x: state.navigator.currentIndex.x, y: state.navigator.currentIndex.y, z: state.navigator.currentIndex.z };\r\n    const isPaused = !!paused.state.paused;\r\n\r\n    const onLeft = (modifier) =>\r\n        updateContext((ctx) => {\r\n            modifier(ctx);\r\n            ctx.navigator.moveLeft(before);\r\n        });\r\n\r\n    const onRight = (modifier) =>\r\n        updateContext((ctx) => {\r\n            modifier(ctx);\r\n            ctx.navigator.moveRight(before);\r\n        });\r\n\r\n    const onUp = (modifier) =>\r\n        updateContext((ctx) => {\r\n            modifier(ctx);\r\n            ctx.navigator.moveUp(before);\r\n        });\r\n\r\n    const onDown = (modifier) =>\r\n        updateContext((ctx) => {\r\n            modifier(ctx);\r\n            ctx.navigator.moveDown(before);\r\n        });\r\n\r\n    const onAction = (modifier) =>\r\n        updateGameContext((ctx) => {\r\n            modifier(ctx);\r\n            state.navigator.pressCurrent()(ctx);\r\n        });\r\n\r\n    const onCancel = (modifier) =>\r\n        updateContext((ctx) => {\r\n            modifier(ctx);\r\n            ctx.hand.stack.length && ctx.hand.stack[0].onClick({ isKeyboard: true })(ctx);\r\n        });\r\n\r\n    const onPause = () => paused.togglePause(isPaused, player);\r\n\r\n    const isVisible = (state) => state.settings.suggestionMode.supportsHints || state.settings.suggestionMode.isTemporary;\r\n    const isDisabled = (state) => state.settings.suggestionMode.isTemporary;\r\n\r\n    const onHint = (modifier) => {\r\n        updateContext((state) => {\r\n            modifier(state);\r\n            if (isVisible(state) && !isDisabled(state)) {\r\n                state.settings.enableHint();\r\n            }\r\n        });\r\n    };\r\n\r\n    const onUndo = () => {\r\n        replaceContext((_state) => {\r\n            const previous = _state.game.timemachine.popPreviousState(state.game.timemachine.previousStates.length - 1, state);\r\n            if (previous) {\r\n                previous.game.rating.penalize(_state.game.rating);\r\n                return previous;\r\n            }\r\n            return null;\r\n        });\r\n    };\r\n    const onMenu = (modifier) => {\r\n        updateContext((state) => {\r\n            modifier(state);\r\n        });\r\n        paused.togglePause(isPaused, player);\r\n    };\r\n\r\n    return isPaused ? null : (\r\n        <>\r\n            <BoardKeyboard\r\n                onLeft={onLeft}\r\n                onRight={onRight}\r\n                onUp={onUp}\r\n                onDown={onDown}\r\n                onAction={onAction}\r\n                onCancel={onCancel}\r\n                onHint={onHint}\r\n                onUndo={onUndo}\r\n                onPause={onPause}\r\n                onMenu={onMenu}\r\n            />\r\n            <BoardGamePad\r\n                onLeft={onLeft}\r\n                onRight={onRight}\r\n                onUp={onUp}\r\n                onDown={onDown}\r\n                onAction={onAction}\r\n                onCancel={onCancel}\r\n                onHint={onHint}\r\n                onUndo={onUndo}\r\n                onPause={onPause}\r\n                onMenu={onMenu}\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nexport default BoardNavigator;\r\n","import GlobalContext from \"../Context\";\r\nimport React from \"react\";\r\n\r\nconst Dealer = () => {\r\n    const { state, replaceContext } = React.useContext(GlobalContext);\r\n    const timeouts = [];\r\n\r\n    if (state.settings.launchSettings.quickDeal) {\r\n        if (state && state.dealer && !state.dealer.isDealt) {\r\n            replaceContext(state.dealer.dealAll(state));\r\n        }\r\n    } else {\r\n        const deal = (dealt) => {\r\n            timeouts.push(\r\n                setTimeout(() => {\r\n                    if (state && state.dealer && !state.dealer.isDealt) {\r\n                        replaceContext(state.dealer.dealOne(dealt, deal));\r\n                    }\r\n                }, 35)\r\n            );\r\n        };\r\n\r\n        React.useEffect(() => {\r\n            deal(state.dealer.dealt);\r\n            return () =>\r\n                timeouts.forEach((timeout) => {\r\n                    clearTimeout(timeout);\r\n                });\r\n        }, []);\r\n        React.useEffect(() => {}, [state.dealer.isDealt]);\r\n    }\r\n    return null;\r\n};\r\nexport default Dealer;\r\n","import { Component } from \"react\";\r\nimport GlobalContext from \"../Context\";\r\n\r\nexport default class BlinkingComponent extends Component {\r\n    constructor(selector) {\r\n        super();\r\n        this.timeout = null;\r\n        this.selector = selector;\r\n    }\r\n\r\n    static contextType = GlobalContext;\r\n\r\n    componentDidUpdate() {\r\n        if (this.selector(this.context.state).blinkFor) {\r\n            this.timeout = setTimeout(\r\n                () =>\r\n                    this.context.updateGameContext((state) => {\r\n                        this.selector(state).unblink(state);\r\n                    }),\r\n                200\r\n            );\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        clearTimeout(this.timeout);\r\n    }\r\n}\r\n","import GlobalContext from \"../Context\";\r\nimport PauseContext from \"../PauseContext\";\r\nimport React from \"react\";\r\n\r\nconst Card = (props) => {\r\n    const { state, updateGameContext } = React.useContext(GlobalContext);\r\n    const pause = React.useContext(PauseContext);\r\n    const inputEl = React.useRef(null);\r\n    const isFocused = state.focus.hasCard(props.model);\r\n    React.useEffect(() => {\r\n        if (isFocused && state.settings.launchSettings.boardMode == \"singleplayer\") {\r\n            inputEl && inputEl.current && inputEl.current.focus();\r\n        }\r\n    }, [isFocused, state.focus.card]);\r\n    const onClick = (e) => {\r\n        e.preventDefault();\r\n        const isKeyBoard = e.clientX == 0 && e.clientY == 0;\r\n        let ele = e.target;\r\n\r\n        while (ele && !ele.className.includes(\"card-base\")) {\r\n            ele = ele.offsetParent;\r\n        }\r\n\r\n        const rect = ele.getBoundingClientRect();\r\n        const position = {\r\n            isKeyBoard,\r\n            click: {\r\n                x: e.clientX - ele.ownerDocument.defaultView.pageXOffset,\r\n                y: e.clientY - ele.ownerDocument.defaultView.pageYOffset,\r\n            },\r\n            element: {\r\n                x: rect.x,\r\n                y: rect.y,\r\n            },\r\n        };\r\n        const isSinglePlayer = state.settings.launchSettings.boardMode === \"singleplayer\";\r\n        //@todo A11Y allow keyboard actions in singleplayer\r\n        if (props.model.onClick && !position.isKeyBoard) {\r\n            updateGameContext((context) => {\r\n                props.model.onClick(position)(context);\r\n                if (isSinglePlayer) {\r\n                    context.settings.launchSettings.inputMode = \"mouse\";\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    const getClassName = () => {\r\n        const hasSuggestion = props.isSuggested || props.model.suggestion;\r\n        let className = `card card-base suit-${props.model.type.icon}`;\r\n        className += !props.isSelected && !isFocused && !hasSuggestion ? ` card-stack-${props.model.source}` : \"\";\r\n        className += props.isSelected ? \" card-selected\" : \"\";\r\n        className += props.blink ? \" blink\" : \"\";\r\n        className += props.model.canClick() ? \" clickable\" : \"\";\r\n        //@todo onhover, trigger highlight of suggested target card/stack (preview what happens if picked up)\r\n        className += hasSuggestion && !isFocused ? \" card-suggested\" : \"\";\r\n        className += isFocused ? \" card-focused\" : \"\";\r\n        return className;\r\n    };\r\n\r\n    const getCardStyle = () => {\r\n        const style = {\r\n            zIndex: (props.zIndex ? props.zIndex : !!props.offsetTop * 20) + 1,\r\n            top: props.offsetTop ? props.offsetTop / 15 + \"em\" : 0,\r\n            ...props.model.entropyStyle,\r\n        };\r\n\r\n        //move to left on waste (triple draw)\r\n        if (props.offsetLeft) {\r\n            style.left = props.offsetLeft * 2 + \"em\";\r\n        }\r\n\r\n        if (!props.model.onClick) {\r\n            style.pointerEvents = \"none\";\r\n        }\r\n\r\n        return style;\r\n    };\r\n\r\n    const getStackbaseStyle = () => {\r\n        if (!props.model.onClick) {\r\n            return { pointerEvents: \"none\" };\r\n        }\r\n\r\n        return {};\r\n    };\r\n\r\n    const names = [0, 1, 2, 3, 4, 5, 6].map((id) => \" stack \" + (id + 1));\r\n    let label = \"\";\r\n    const split = props.model.source.split(\"-\");\r\n    label += split[0];\r\n    if (split.length > 1) {\r\n        label += names[split[1]];\r\n    }\r\n    label += \": \";\r\n\r\n    label += props.model.isHidden ? \"hidden card\" : props.model.type.icon + props.model.face;\r\n\r\n    // @todo 3d flip https://3dtransforms.desandro.com/card-flip on unhide\r\n    // https://medium.com/hackernoon/5-ways-to-animate-a-reactjs-app-in-2019-56eb9af6e3bf\r\n\r\n    return (\r\n        <div style={getStackbaseStyle()} className=\"stack-base\">\r\n            <button\r\n                onFocus={() => {\r\n                    // updateContext((ctx) => {\r\n                    //     ctx.navigator.update(props.model.source, props.model);\r\n                    // });\r\n                }}\r\n                onBlur={() => {\r\n                    //updateContext((ctx) => ctx.focus.unsetCard(props.model));\r\n                }}\r\n                style={getCardStyle()}\r\n                ref={inputEl}\r\n                className={getClassName()}\r\n                onClick={onClick ? onClick : null}\r\n                disabled={!props.model.canClick() || pause.state.paused}\r\n                tabIndex={props.model.canClick() ? 0 : -1}\r\n                aria-label={label}\r\n                title={label}\r\n            >\r\n                <div className=\"card-content\">\r\n                    {props.model.isHidden || pause.state.paused ? (\r\n                        <div className=\"card-back\">&nbsp;</div>\r\n                    ) : (\r\n                        <div className=\"card-grid-container\">\r\n                            <div>\r\n                                <div className=\"align-center\">{props.model.type.icon}</div>\r\n                            </div>\r\n                            <div>\r\n                                <div className=\"align-left\">{props.model.face}</div>\r\n                            </div>\r\n                            <div>&nbsp;</div>\r\n                            <div>\r\n                                <div className=\"align-center\">{props.model.type.icon}</div>\r\n                            </div>\r\n                            <div className=\"mainface\">\r\n                                <div className=\"align-center\">{props.model.face}</div>\r\n                            </div>\r\n                            <div>\r\n                                <div className=\"align-center\">{props.model.type.icon}</div>\r\n                            </div>\r\n                            <div>&nbsp;</div>\r\n                            <div>\r\n                                <div className=\"align-right\">{props.model.face}</div>\r\n                            </div>\r\n                            <div>\r\n                                <div className=\"align-center\">{props.model.type.icon}</div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Card;\r\n","import GlobalContext from \"../Context\";\r\nimport React from \"react\";\r\nimport Card from \"./Card\";\r\n\r\nconst Hand = (props) => {\r\n    const { state } = React.useContext(GlobalContext);\r\n    if (!state.hand || props.parentModel.source !== state.hand.source) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            {[\r\n                state.hand &&\r\n                    state.hand.stack &&\r\n                    state.hand.stack.map((card, index) => (\r\n                        <Card\r\n                            key={index}\r\n                            model={card}\r\n                            offsetTop={props.offsetTop + index * 24}\r\n                            offsetLeft={props.offsetLeft}\r\n                            zIndex={1000 + index * 20}\r\n                            isSelected={true}\r\n                            onClick={(_c, p) => props.onClick(p)}\r\n                        />\r\n                    )),\r\n            ]}\r\n        </>\r\n    );\r\n};\r\n\r\nexport default Hand;\r\n","import GlobalContext from \"../Context\";\r\nimport React from \"react\";\r\n\r\nconst StackBase = (props) => {\r\n    let classname = \"card-base socket\";\r\n    const inputEl = React.useRef(null);\r\n    const { state, updateGameContext } = React.useContext(GlobalContext);\r\n    React.useEffect(() => {\r\n        if (state.focus.hasStack(props.model.parent) && state.settings.launchSettings.boardMode == \"singleplayer\") {\r\n            inputEl && inputEl.current && inputEl.current.focus();\r\n        }\r\n    });\r\n    if (!props.model.stack.length) {\r\n        if (props.model.blinkFor) {\r\n            classname += \" socket-blink\";\r\n        } else if (state.focus.hasStack(props.model.source)) {\r\n            classname += \" socket-focused\";\r\n        } else {\r\n            classname += \" socket-empty\";\r\n        }\r\n    } else {\r\n        classname += \" socket-full\";\r\n    }\r\n\r\n    if (props.model.suggestion && !props.model.stack.length) {\r\n        classname += \" socket-suggested\";\r\n    }\r\n\r\n    const onClick = (e) => {\r\n        e.preventDefault();\r\n        const isKeyBoard = e.clientX == 0 && e.clientY == 0;\r\n        if (!isKeyBoard) {\r\n            updateGameContext(props.model.clickEmpty({ isKeyBoard }));\r\n        }\r\n    };\r\n\r\n    const names = [0, 1, 2, 3, 4, 5, 6].map((id) => \" stack \" + (id + 1));\r\n    let label = \"\";\r\n    const split = props.model.source.split(\"-\");\r\n    label += split[0];\r\n    if (split.length > 1) {\r\n        label += names[split[1]]\r\n    }\r\n    label += \": empty socket\"\r\n\r\n    return (\r\n        <button\r\n            onFocus={() => {\r\n                // updateContext((ctx) => {\r\n                //     ctx.navigator.update(props.model.parent);\r\n                // });\r\n            }}\r\n            onBlur={() => {\r\n                // updateContext((ctx) => ctx.focus.unsetStack(props.model.parent));\r\n            }}\r\n            ref={inputEl}\r\n            className={classname}\r\n            onClick={onClick}\r\n            disabled={props.model.stack.length}\r\n            tabIndex={!props.model.stack.length ? 0 : -1}\r\n            aria-label={label}\r\n            title={label}\r\n\r\n        >\r\n            {props.children}\r\n        </button>\r\n    );\r\n};\r\nexport default StackBase;\r\n","import BlinkingComponent from \"./BlinkingComponent\";\r\nimport Card from \"./Card\";\r\nimport GlobalContext from \"../Context\";\r\nimport Hand from \"./Hand\";\r\nimport React from \"react\";\r\nimport StackBase from \"./StackBase\";\r\n\r\nexport default class Foundation extends BlinkingComponent {\r\n    constructor(props) {\r\n        super((s) => s.foundation.stacks[props.index]);\r\n    }\r\n\r\n    static Stacks = () => {\r\n        const { state } = React.useContext(GlobalContext);\r\n        return (\r\n            <>\r\n                {state.foundation.stacks.map((foundation, index) => (\r\n                    <Foundation key={index} model={foundation} index={index} />\r\n                ))}\r\n            </>\r\n        );\r\n    };\r\n\r\n    render() {\r\n        const model = this.props.model;\r\n        return (\r\n            <div className=\"board-field\" key={this.props.index}>\r\n                <StackBase model={model}>\r\n                    <div className={\"align-center foundation-base suit-\" + model.icon}>{model.icon}</div>\r\n                </StackBase>\r\n                {model.stack.map((card, index) => (\r\n                    <Card\r\n                        key={index}\r\n                        model={card}\r\n                        blink={model.blinkFor}\r\n                        isSuggested={model.suggestion && model.stack.length - 1 == index}\r\n                    />\r\n                ))}\r\n                <Hand\r\n                    parentModel={model}\r\n                    //onClick={(c, p) => onClick(model.stack[model.stack.length - 1], p, this.props.index)}\r\n                    stack={model.stack}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import PauseContext from \"../../PauseContext\";\r\nimport React from \"react\";\r\n\r\nconst Clock = () => {\r\n    const { state, getElapsed } = React.useContext(PauseContext);\r\n    const [elapsed, setElapsed] = React.useState(\"\");\r\n    React.useEffect(() => {\r\n        const interval = setInterval(() => {\r\n            if (state.started && !state.paused) {\r\n                setElapsed(getElapsed());\r\n            }\r\n        }, 1000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [state.started, state.paused]);\r\n\r\n    return !state.started || !elapsed ? null : (\r\n        <div className=\"header-clock\">\r\n            <div className=\"icon-container\">🕒</div>\r\n            {elapsed}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Clock;\r\n","import GlobalContext from \"../../Context\";\r\nimport React from \"react\";\r\n\r\nconst Hearts = () => {\r\n    const { state } = React.useContext(GlobalContext);\r\n    if (!state) return null;\r\n    const getHearts = () => {\r\n        if (state.settings.launchSettings.recyclingMode == \"infinite\") {\r\n            return \"🖤\";\r\n        }\r\n\r\n        if (state.settings.launchSettings.recyclingMode == \"1-pass\") {\r\n            return state.stock.passes > 0 ? \"❤️\" : \"💔\";\r\n        }\r\n\r\n        if (state.settings.launchSettings.recyclingMode == \"3-pass\") {\r\n            const createString = (length: number, icon: string) =>\r\n                Array.from(new Array(length).keys())\r\n                    .map(() => icon)\r\n                    .join(\"\");\r\n\r\n            return createString(state.stock.passes, \"❤️\") + createString(3 - state.stock.passes, \"💔\");\r\n        }\r\n        return null;\r\n    };\r\n    return <div className=\"heart-container\">{getHearts()}</div>;\r\n};\r\nexport default Hearts;\r\n","import GlobalContext from \"../../Context\";\r\nimport Model from \"../../../Model/Model\";\r\nimport React from \"react\";\r\n\r\nconst Hint = () => {\r\n    const { state, updateContext } = React.useContext(GlobalContext);\r\n    if (!state) return null;\r\n    const isVisible = (state: Model) => state.settings.suggestionMode.supportsHints || state.settings.suggestionMode.isTemporary;\r\n\r\n    const isDisabled = (state: Model) => state.settings.suggestionMode.isTemporary;\r\n\r\n    const suggestOnce = () =>\r\n        updateContext((state) => {\r\n            if (isVisible(state) && !isDisabled(state)) {\r\n                state.settings.enableHint();\r\n            }\r\n        });\r\n\r\n    return !isVisible(state) ? null : (\r\n        <div>\r\n            <button title=\"Hint\" onClick={() => suggestOnce()} disabled={isDisabled(state)}>\r\n                <span className=\"icon\">💡</span>\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\nexport default Hint;\r\n","import GlobalContext from \"../../Context\";\r\nimport React from \"react\";\r\n\r\nconst Points = () => {\r\n    const { state } = React.useContext(GlobalContext);\r\n\r\n    return (\r\n        <>\r\n            <div className=\"icon-container\">🏆</div> {state?.game.rating.points}\r\n        </>\r\n    );\r\n};\r\n\r\nexport default Points;\r\n","import { BoardContext } from \"../../Game/BoardWrap\";\r\nimport PauseContext from \"../../PauseContext\";\r\nimport React from \"react\";\r\n\r\nconst ToggleMenu = () => {\r\n    const paused = React.useContext(PauseContext);\r\n    const { player } = React.useContext(BoardContext);\r\n\r\n    return (\r\n        <div>\r\n            <button title=\"Settings\" onClick={() => paused.togglePause(!paused.state.paused, player)}>\r\n                <span className=\"icon\">☰</span>\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ToggleMenu;\r\n","import GlobalContext from \"../../Context\";\r\nimport React from \"react\";\r\n\r\nconst Undo = () => {\r\n    const { state, replaceContext } = React.useContext(GlobalContext);\r\n    if (!state) return null;\r\n\r\n    const undo = () =>\r\n        replaceContext((_state) => {\r\n            const previous = _state.game.timemachine.popPreviousState(state.game.timemachine.previousStates.length - 1, state);\r\n            if (previous) {\r\n                previous.game.rating.penalize(_state.game.rating);\r\n                return previous;\r\n            }\r\n            return null;\r\n        });\r\n\r\n    if (!state.game.timemachine.previousStates.length) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <button\r\n                disabled={!state.game.timemachine.previousStates.length}\r\n                title={\"Undo (Penalty:\" + Math.pow(2, state.game.rating.multiplicator) + \")\"}\r\n                onClick={undo}\r\n            >\r\n                <span className=\"icon\">⏪</span>\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Undo;\r\n","import \"../../Style/Header.css\";\r\n\r\nimport Clock from \"./Clock\";\r\nimport Hearts from \"./Hearts\";\r\nimport Hint from \"./Hint\";\r\nimport Points from \"./Points\";\r\nimport React from \"react\";\r\nimport ToggleMenu from \"./ToggleMenu\";\r\nimport Undo from \"./Undo\";\r\n\r\nconst Header = (props: {mode: string}) => (\r\n    <div className={\"header \" + props.mode}>\r\n        <div className=\"header-title\">\r\n            <Hearts />\r\n            <Points />\r\n        </div>\r\n        <Clock />\r\n        <div className=\"header-buttons\">\r\n            <Hint />\r\n            <Undo />\r\n            <ToggleMenu />\r\n        </div>\r\n    </div>\r\n);\r\n\r\nexport default Header;\r\n","import \"../Style/Menu.scss\";\r\n\r\nimport { NavigationContext, NavigationProvider, NavigationState } from \"./StartScreen/Context\";\r\nimport { Universal, getKeyboardLayout } from \"../Game/KeyboardLayouts\";\r\n\r\nimport { BoardContext } from \"../Game/BoardWrap\";\r\nimport EntropyLevels from \"../../Model/Game/Settings/EntropyLevels\";\r\nimport GlobalContext from \"../Context\";\r\nimport MenuButton from \"./StartScreen/Menu/MenuButton\";\r\nimport MenuTitle from \"./StartScreen/Menu/MenuTitle\";\r\nimport MenuTree from \"./StartScreen/Menu/MenuTree\";\r\nimport PauseContext from \"../PauseContext\";\r\nimport React from \"react\";\r\nimport SuggestionModes from \"../../Model/Game/Settings/SuggestionModes\";\r\nimport { XY } from \"./XY\";\r\n\r\nconst _Menu = () => {\r\n    const [navigation, setNavigation] = React.useState<NavigationState>({\r\n        menu: {\r\n            x: 0,\r\n            y: 0,\r\n        },\r\n        screen: {\r\n            x: 0,\r\n            y: 0,\r\n        },\r\n        focus: \"menu\",\r\n        mainMenu: \"\",\r\n        screeen: \"\",\r\n    });\r\n    const navigationContext = {\r\n        navigation,\r\n        setNavigation,\r\n    };\r\n    return (\r\n        <NavigationProvider value={navigationContext}>\r\n            <Menu />\r\n        </NavigationProvider>\r\n    );\r\n};\r\nconst Menu = () => {\r\n    const { state, updateContext, replaceContext, restart } = React.useContext(GlobalContext);\r\n    const pause = React.useContext(PauseContext);\r\n    const { player } = React.useContext(BoardContext);\r\n    const reset = () => {\r\n        //this is a bad hack?\r\n        pause.togglePause(true, -1);\r\n        replaceContext((state) => (state.game.timemachine.previousStates ? state.game.timemachine.previousStates[0] : null));\r\n    };\r\n\r\n    //@todo persist game settings in local storage too and use for initialization\r\n    const setSuggestionMode = (sm: string) => updateContext((state) => state.settings.setSuggestionMode(sm));\r\n    const setBaseEntropy = (lvl: number) => updateContext((state) => state.setEntropy(lvl));\r\n    const setInteractionEntropy = (lvl: number) => updateContext((state) => (state.settings.interactionEntropy = lvl));\r\n\r\n    const toggleMenu = () => {\r\n        pause.togglePause(false, -1);\r\n    };\r\n\r\n    const { navigation, setNavigation } = React.useContext(NavigationContext);\r\n\r\n    const switchToMenu = (menu: string, pos: XY) =>\r\n        setNavigation({ ...navigation, focus: \"menu\", screeen: \"\", mainMenu: menu, menu: { ...pos } });\r\n\r\n    const toggleMainMenu = (val: string, pos: XY) => {\r\n        if (navigation.mainMenu !== val) {\r\n            switchToMenu(val, pos);\r\n        } else {\r\n            switchToMenu(\"\", pos);\r\n        }\r\n    };\r\n\r\n    if (!pause.state.showMenu) {\r\n        return null;\r\n    }\r\n    if (!state) {\r\n        return null;\r\n    }\r\n    const onfocus = (pos: XY) => {\r\n        setNavigation({ ...navigation, menu: pos });\r\n    };\r\n\r\n    const remaining = pause.state.allowed - pause.state.pauses.length - 1;\r\n\r\n    let announcement = `You can pause the game ${remaining} more times.`;\r\n    if (remaining == 1) {\r\n        announcement = `You can pause the game ${remaining} more time.`;\r\n    }\r\n    if (remaining == 0) {\r\n        announcement = \"This is the last remaining pause. If you continue, no more pause will be possible.\";\r\n    }\r\n    if (remaining < 0) [(announcement = \"The game is not paused.\")];\r\n\r\n    const isSinglePlayer = state.settings.launchSettings.boardMode === \"singleplayer\";\r\n    const keyboardLayout = isSinglePlayer ? Universal : getKeyboardLayout(state.settings.launchSettings.players[player].inputLayout);\r\n\r\n    if (pause.state.pausedBy !== player) {\r\n        return (\r\n            <div className=\"gamemenu menu\">\r\n                <div className=\"startscreen-jail\">\r\n                    <div className=\"innermenu\">\r\n                        <MenuTitle label=\"😴\" />\r\n                        {pause.state.pausedBy}\r\n                        <div className=\"announcement\">{announcement}</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"gamemenu menu\">\r\n            <div className=\"startscreen-jail\">\r\n                <div className=\"innermenu\">\r\n                    <MenuTitle label=\"😴\" />\r\n\r\n                    <div className=\"announcement\">{announcement}</div>\r\n                    <MenuTree keyboardLayout={keyboardLayout}>\r\n                        <MenuButton\r\n                            icon=\"▶️\"\r\n                            title=\"Resume\"\r\n                            onClick={() => {\r\n                                toggleMenu();\r\n                            }}\r\n                            onFocus={onfocus}\r\n                        />\r\n                        <MenuButton\r\n                            icon={state.settings.suggestionMode.icon}\r\n                            title={`Suggestions: ${state.settings.suggestionMode.label}`}\r\n                            onClick={() => {\r\n                                setSuggestionMode(SuggestionModes.next(state.settings.suggestionMode).key);\r\n                            }}\r\n                            onFocus={onfocus}\r\n                        />\r\n                        <MenuButton\r\n                            icon=\"🌪️\"\r\n                            title=\"Entropy\"\r\n                            onClick={(pos: XY) => toggleMainMenu(\"entropy\", pos)}\r\n                            onFocus={onfocus}\r\n                            toggled={navigation.mainMenu == \"entropy\"}\r\n                        >\r\n                            <MenuButton\r\n                                icon=\"🌪️\"\r\n                                title={`Base Entropy: ${EntropyLevels[state.settings.baseEntropy]}`}\r\n                                onClick={() => {\r\n                                    setBaseEntropy(\r\n                                        state.settings.baseEntropy < EntropyLevels.length - 1 ? state.settings.baseEntropy + 1 : 0\r\n                                    );\r\n                                }}\r\n                                onFocus={onfocus}\r\n                            />\r\n                            <MenuButton\r\n                                icon=\"🌬️\"\r\n                                title={`Action Entropy: ${EntropyLevels[state.settings.interactionEntropy]}`}\r\n                                onClick={() => {\r\n                                    setInteractionEntropy(\r\n                                        state.settings.interactionEntropy < EntropyLevels.length - 1\r\n                                            ? state.settings.interactionEntropy + 1\r\n                                            : 0\r\n                                    );\r\n                                }}\r\n                                onFocus={onfocus}\r\n                            />\r\n                        </MenuButton>\r\n                        <MenuButton\r\n                            icon=\"♻️\"\r\n                            title=\"Restart Game\"\r\n                            onClick={() => reset()}\r\n                            onFocus={onfocus}\r\n                            skip={!state.game.timemachine.previousStates.length}\r\n                        />\r\n                        <MenuButton icon=\"🗑️\" title=\"Quit Game\" onClick={() => restart()} onFocus={onfocus} />\r\n                    </MenuTree>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\nexport default _Menu;\r\n","import BlinkingComponent from \"./BlinkingComponent\";\r\nimport Card from \"./Card\";\r\nimport GlobalContext from \"../Context\";\r\nimport PauseContext from \"../PauseContext\";\r\nimport React from \"react\";\r\nimport StackBase from \"./StackBase\";\r\n\r\nconst usePrevious = (value) => {\r\n    const ref = React.useRef();\r\n    React.useEffect(() => {\r\n        ref.current = value;\r\n    });\r\n    return ref.current;\r\n};\r\n\r\nconst Renderer = (props) => {\r\n    const { state } = React.useContext(PauseContext);\r\n    const { paused, started } = state;\r\n    return <InnerRenderer length={props.length} paused={paused} started={started} />;\r\n};\r\n\r\nconst InnerRenderer = (props) => {\r\n    const context = React.useContext(GlobalContext);\r\n    const { length, started, paused } = props;\r\n    const previous = usePrevious({ length, paused, started });\r\n    React.useEffect(() => {\r\n        let timeout = null;\r\n        if (context.state.settings.launchSettings.speed && previous && started && !paused && (previous.length != length || previous.started != started || previous.paused != paused)) {\r\n            timeout = setTimeout(() => {\r\n                context.updateContext((state) => {\r\n                    if (length == state.stock.stack.length && state.stock.passes > 0 && (state.stock.stack.length || state.waste.stack.length)) {\r\n                        if (state.hand.isFromWaste()) {\r\n                            state.waste.putDownHand();\r\n                        }\r\n                        if (state.stock.stack.length) {\r\n                            state.waste.addAll(state.stock.popTop());\r\n                        } else if (state.stock.canRecycle()) {\r\n                            state.stock.recycle(state.waste.recycle());\r\n                        }\r\n                    }\r\n                });\r\n            }, 10000);\r\n        }\r\n        return () => clearTimeout(timeout);\r\n    }, [length, paused, started]);\r\n\r\n    return (\r\n        <div className=\"board-field stock\">\r\n            <StackBase model={context.state.stock} />\r\n            {context.state.stock.stack.map((card, index) => (\r\n                <Card\r\n                    key={index}\r\n                    model={card}\r\n                    offsetTop={(index / 2) * -1}\r\n                    zIndex={index}\r\n                    blink={context.state.stock.blinkFor}\r\n                    isSuggested={context.state.stock.suggestion && index == context.state.stock.stack.length - 1}\r\n                />\r\n            ))}\r\n        </div>\r\n    );\r\n};\r\n//Can't use multiple contexts in one React class, need two renderer functions to feed two contexts into props for reliable detection of changes\r\nexport default class Stock extends BlinkingComponent {\r\n    constructor() {\r\n        super((s) => s.stock);\r\n    }\r\n\r\n    render() {\r\n        return <Renderer length={this.context.state.stock.stack.length} />;\r\n    }\r\n}\r\n","import BlinkingComponent from \"./BlinkingComponent\";\r\nimport Card from \"./Card\";\r\nimport GlobalContext from \"../Context\";\r\nimport Hand from \"./Hand\";\r\nimport React from \"react\";\r\nimport StackBase from \"./StackBase\";\r\n\r\nexport default class Tableau extends BlinkingComponent {\r\n    constructor(props) {\r\n        super((s) => s.tableau.stacks[props.index]);\r\n    }\r\n\r\n    static Stacks = () => {\r\n        const { state } = React.useContext(GlobalContext);\r\n        return (\r\n            <>\r\n                {state.tableau.stacks.map((tableau, index) => (\r\n                    <Tableau key={index} index={index} model={tableau} parent={state.tableau} />\r\n                ))}\r\n            </>\r\n        );\r\n    };\r\n\r\n    render() {\r\n        const props = this.props;\r\n        let offset = 1;\r\n        const getOffset = (index) => {\r\n            for (let i = 0; i <= index; i++) {\r\n                if (props.model.stack[i] && !props.model.stack[i].isHidden) {\r\n                    offset = i * 12 + (index - i) * 24;\r\n                    return offset;\r\n                }\r\n            }\r\n            offset = index * 12;\r\n            return offset;\r\n        };\r\n\r\n        return (\r\n            <div className=\"board-field\">\r\n                <StackBase model={props.model} />\r\n                {props.model.stack.map((card, index) => (\r\n                    <Card\r\n                        key={index}\r\n                        model={card}\r\n                        blink={props.model.blinkFor}\r\n                        isSuggested={props.model.suggestion && props.model.stack.length - 1 == index}\r\n                        offsetTop={getOffset(index)}\r\n                    />\r\n                ))}\r\n                <Hand parentModel={props.model} stack={props.model.stack} offsetTop={getOffset(props.model.stack.length)} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import BlinkingComponent from \"./BlinkingComponent\";\r\nimport Card from \"./Card\";\r\nimport Hand from \"./Hand\";\r\nimport React from \"react\";\r\nimport StackBase from \"./StackBase\";\r\n\r\nexport default class Waste extends BlinkingComponent {\r\n    constructor() {\r\n        super((s) => s.waste);\r\n    }\r\n\r\n    render() {\r\n        const { state } = this.context;\r\n        const getOffset = (index) => {\r\n            if (state.settings.launchSettings.drawMode == \"single\") {\r\n                return 0;\r\n            }\r\n            const length = state.hand.isHoldingCard() && state.hand.isFromWaste() ? state.waste.stack.length + 1 : state.waste.stack.length;\r\n            let additionalOffset = 2;\r\n            if (length == 2) {\r\n                additionalOffset = 1;\r\n            }\r\n\r\n            if (length == 1) {\r\n                additionalOffset = 0;\r\n            }\r\n\r\n            return ((index - length - 2) % 3) + additionalOffset;\r\n        };\r\n\r\n        return (\r\n            <div className=\"board-field\">\r\n                <StackBase model={state.waste} />\r\n                {state.waste.stack.map((card, index) => (\r\n                    <Card\r\n                        key={index}\r\n                        model={card}\r\n                        offsetTop={(index / 2) * -1}\r\n                        offsetLeft={getOffset(index)}\r\n                        blink={state.waste.blinkFor}\r\n                        isSuggested={state.waste.suggestion && index == state.waste.stack.length - 1}\r\n                    />\r\n                ))}\r\n                <Hand\r\n                    offsetTop={(state.waste.stack.length / 2) * -1}\r\n                    offsetLeft={getOffset(state.waste.stack.length)}\r\n                    parentModel={state.waste}\r\n                    stack={state.waste.stack}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import \"../Style/Board.scss\";\r\n\r\nimport BoardNavigator from \"./BoardNavigator\";\r\nimport Dealer from \"./Dealer\";\r\nimport Foundation from \"./Foundation\";\r\nimport Header from \"../UI/Header/Header\";\r\nimport Menu from \"../UI/Menu\";\r\nimport React from \"react\";\r\nimport Stock from \"./Stock\";\r\nimport Tableau from \"./Tableau\";\r\nimport Waste from \"./Waste\";\r\n\r\nconst Board = (props: any) => (\r\n    <>\r\n        <Menu />\r\n        <Header mode={props.mode} />\r\n        <div className={\"board-jail \" + props.mode}>\r\n            <div className={\"board-grid-container \" + props.mode}>\r\n                <Stock />\r\n                <Waste />\r\n                <div className=\"spacer\">&nbsp;</div>\r\n                <Foundation.Stacks />\r\n                <Tableau.Stacks />\r\n            </div>\r\n        </div>\r\n        <Dealer />\r\n        <BoardNavigator />\r\n    </>\r\n);\r\n\r\nexport default Board;\r\n","import \"../Style/Screens.scss\";\r\n\r\nimport GlobalContext from \"../Context\";\r\nimport PauseContext from \"../PauseContext\";\r\nimport React from \"react\";\r\n\r\nconst EndScreen = () => {\r\n    const { state, restart } = React.useContext(GlobalContext);\r\n    const pause = React.useContext(PauseContext);\r\n    //@todo show launch settings (draw mode, recycling mode)\r\n    return !state.game.isEnded ? null : (\r\n        <div className=\"ui neutral endscreen\">\r\n            <div className=\"title\">🥳</div>\r\n            <div className=\"content\">\r\n                <div>Time: {pause.getElapsed()}</div>\r\n                <div>Points: {state.game.rating.points}</div>\r\n                <div>Time Penalty: {state.game.rating.getTimePenalty(state.game.started, state.game.end || Date.now())}</div>\r\n                <div>Bonus Points: {state.game.rating.getBonusPoints(state.game.started, state.game.end || Date.now())}</div>\r\n                <div>Total Points: {state.game.rating.getTotal(state.game.started, state.game.end || Date.now())}</div>\r\n                <div>\r\n                    <button onClick={restart}>\r\n                        🗑️<div>New Game</div>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default EndScreen;\r\n","import Model from \"../Model\";\r\nimport Stock from \"../Game/Stock\";\r\nimport Waste from \"../Game/Waste\";\r\n\r\nexport type BlinkSelector = (state: Model) => Waste | Stock | any;\r\n\r\nexport interface IBlinker {\r\n    startBlink: (selector: BlinkSelector, state: Model) => void;\r\n}\r\n\r\nexport default class Blinker implements IBlinker {\r\n    startBlink = (selector: BlinkSelector, state: Model) => {\r\n        if (selector(state).blinkFor < 10) {\r\n            selector(state).blinkFor = 10;\r\n            state.game.registerBlink(true);\r\n            selector(state).unblink = (s: Model) => this.stopBlink(selector, s);\r\n        }\r\n    };\r\n\r\n    stopBlink = (selector: BlinkSelector, state: Model) => {\r\n        selector(state).blinkFor = 0;\r\n        state.game.registerBlink(false);\r\n    };\r\n}\r\n","import { BlinkFunction, ClickHandler } from \"../../Common\";\r\n\r\nimport Blinker from \"./Blinker\";\r\nimport Card from \"../Deck/Card\";\r\nimport Model from \"../Model\";\r\n\r\nexport default class Tableau implements ClickHandler {\r\n    blink: BlinkFunction = (state, index) => new Blinker().startBlink((s: Model) => s.tableau.stacks[index], state);\r\n\r\n    dispatchPutDown = (card: Card, position: any, state: Model, index: number) => {\r\n        if (state.tableau.wouldAcceptHand(index)) {\r\n            const src = state.hand.source;\r\n            state.tableau.putDownHand(index) && state.game.registerMove(\"tableau-\" + index, src);\r\n        } else {\r\n            this.blink(state, index);\r\n        }\r\n    };\r\n\r\n    dispatchPickup = (card: Card, position: any, state: Model, index: number) => {\r\n        if (card) {\r\n            state.hand.pickUp(state.tableau.popWithFollowing(card, index), card.source, position) && state.game.registerPickup();\r\n        } else if (!card) {\r\n            this.blink(state, index);\r\n        }\r\n    };\r\n}\r\n\r\nexport class TableauHidden extends Tableau {\r\n    dispatchPickup = (card: Card, position: any, state: Model, index: number) => {\r\n        if (card) {\r\n            this.tryUncover(card, index, state);\r\n        }\r\n    };\r\n\r\n    tryUncover = (card: Card, index: number, state: Model) =>\r\n        !state.hand.isHoldingCard() && card.isHidden && state.tableau.uncover(index, card) && state.game.registerUncover();\r\n}\r\n","import Model from \"../Model\";\r\nimport Stock from \"../Game/Stock\";\r\nimport Tableau from \"../Game/Tableau\";\r\n\r\nexport default class Dealer {\r\n    dealt: number;\r\n    dealingAt: number;\r\n    isDealt: boolean;\r\n\r\n    constructor() {\r\n        this.dealt = 0;\r\n        this.dealingAt = 0;\r\n        this.isDealt = false;\r\n    }\r\n\r\n    dealOne = (dealt: number, callback: any) => (state: Model) => {\r\n        if (dealt != state.dealer.dealt) {\r\n            return null;\r\n        }\r\n\r\n        state.dealer.deal(state.stock, state.tableau);\r\n        if (state.dealer.isDealt) {\r\n            state.game.started = Date.now();\r\n        }\r\n\r\n        if (!state.dealer.isDealt) {\r\n            callback(state.dealer.dealt);\r\n        }\r\n\r\n        return state;\r\n    };\r\n\r\n    dealAll = () => (state: Model) => {\r\n        if (this.dealt != state.dealer.dealt) {\r\n            return null;\r\n        }\r\n        while (!state.dealer.isDealt) {\r\n            state.dealer.deal(state.stock, state.tableau);\r\n        }\r\n        state.game.started = Date.now();\r\n        return state;\r\n    };\r\n\r\n    deal = (stock: Stock, tableau: Tableau) => {\r\n        for (let i = this.dealingAt; i < tableau.stacks.length; i++) {\r\n            const stack = tableau.stacks[i].stack;\r\n            if (stack.length <= tableau.stacks.length - i - 1) {\r\n                const newCard = stock.popOne();\r\n                newCard.source = tableau.stacks[i].source;\r\n                if (stack.length == tableau.stacks.length - 1 - i) {\r\n                    newCard.isHidden = false;\r\n                }\r\n                tableau.deal(newCard, i);\r\n                this.dealt++;\r\n                this.dealingAt++;\r\n                if (this.dealingAt == tableau.stacks.length) {\r\n                    this.dealingAt = 0;\r\n                }\r\n                this.isDealt = false;\r\n                return;\r\n            } else {\r\n                const isFirst = this.dealingAt == 0;\r\n                this.dealingAt = 0;\r\n                this.isDealt = isFirst;\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.isDealt = true;\r\n    };\r\n}\r\n","import Card from \"../Deck/Card\";\r\nimport { ClickHandler } from \"../../Common\";\r\nimport Hand from \"../Game/Hand\";\r\nimport Model from \"../Model\";\r\n\r\nexport default class Dispatcher {\r\n    clickHandler: ClickHandler;\r\n\r\n    constructor(clickHandler: ClickHandler) {\r\n        this.clickHandler = clickHandler;\r\n    }\r\n\r\n    getHandler = (hand: Hand) => {\r\n        if (hand && hand.isHoldingCard()) {\r\n            return this.dispatchPutDown;\r\n        } else {\r\n            return this.dispatchPickup;\r\n        }\r\n    };\r\n\r\n    dispatchPutDown = (card: Card, position: any, index: number) => (state: Model) => {\r\n        if (state.hand.isHoldingCard()) {\r\n            this.clickHandler.dispatchPutDown(card, position, state, index);\r\n        }\r\n    };\r\n\r\n    dispatchPickup = (card: Card, position: any, index: number) => (state: Model) => {\r\n        if (!state.hand.isHoldingCard()) {\r\n            this.clickHandler.dispatchPickup(card, position, state, index);\r\n        }\r\n    };\r\n}\r\n","import Card from \"../Deck/Card\";\r\nimport Settings from \"./Settings\";\r\n\r\nexport default class Focus {\r\n    settings: Settings;\r\n    card: Card | null;\r\n    stack: string;\r\n    keyboard: boolean;\r\n    constructor(settings: Settings) {\r\n        this.settings = settings;\r\n        this.card = null;\r\n        this.stack = \"\";\r\n        this.keyboard = false;\r\n    }\r\n\r\n    validSettings = () => this.settings.launchSettings.inputMode !== \"mouse\";\r\n\r\n    isKeyBoard = (isKeyboard: boolean) => {\r\n        this.keyboard = isKeyboard;\r\n    };\r\n\r\n    setCard = (card: Card) => {\r\n        this.card = card;\r\n        this.stack = \"\";\r\n    };\r\n\r\n    unsetCard = (card: Card) => {\r\n        if (this.card && card && Card.equals(this.card, card)) {\r\n            this.card = null;\r\n        }\r\n    };\r\n\r\n    unsetStack = (stack: string) => {\r\n        if (this.stack && stack && this.stack == stack) {\r\n            this.stack = \"\";\r\n        }\r\n    };\r\n\r\n    setStack = (stack: string) => {\r\n        this.card = null;\r\n        this.stack = stack;\r\n    };\r\n\r\n    hasCard = (card: Card) => this.keyboard && this.validSettings() && this.card && card && Card.equals(this.card, card);\r\n\r\n    hasStack = (stack: string) => this.keyboard && this.validSettings() && this.stack && stack && this.stack == stack;\r\n}\r\n","export default class BasicStack {\r\n    constructor(source) {\r\n        this.source = source;\r\n    }\r\n    stack = [];\r\n    getTop = () => this.stack && this.stack.length && this.stack[this.stack.length - 1];\r\n    suggestion = false;\r\n    getClickable = () => this.stack.filter((card) => card.canClick());\r\n}\r\n","import BasicStack from \"./BasicStack\";\r\n\r\nexport default class HandHoldingStack extends BasicStack {\r\n    constructor(source, hand) {\r\n        super(source);\r\n        this.hand = hand;\r\n    }\r\n    getHandContent = () => (this.hand.source == this.source ? this.hand.stack : []);\r\n    getClickable = () => [...this.stack.filter((card) => card.canClick()), ...this.getHandContent().filter((card) => card.canClick())];\r\n}\r\n","import Card from \"../Deck/Card\";\r\nimport HandHoldingStack from \"./HandHoldingStack\";\r\nimport Suits from \"../Deck/Suits\";\r\nimport { getFoundationOrder } from \"../Deck/DeckSize\";\r\n\r\nexport default class Foundation {\r\n    constructor(settings, hand) {\r\n        this.settings = settings;\r\n        this.hand = hand;\r\n        const template = (index) => {\r\n            const s = new HandHoldingStack(\"foundation-\" + index, hand);\r\n            s.stack = [];\r\n            s.acceptedCards = [...getFoundationOrder()];\r\n            s.usedCards = [];\r\n            s.icon = null;\r\n            s.color = null;\r\n            s.blinkFor = 0;\r\n            return s;\r\n        };\r\n        const stacks = Object.keys(Suits)\r\n            .map((key) => Suits[key])\r\n            .map((suit, index) => ({ ...template(index), ...suit }));\r\n        this.stacks = [...stacks];\r\n        // eslint-disable-next-line no-unused-vars\r\n        this.blinkFor = 0;\r\n        this.unblink = () => {};\r\n    }\r\n\r\n    setOnClick = (onClick) => {\r\n        this.stacks.forEach((stack, index) => {\r\n            stack.clickEmpty = (p) => onClick(null, p, index);\r\n            stack.stack.forEach((card, sindex) => {\r\n                card.onClick = (p) => onClick({ ...card }, p, index);\r\n                card.canClick = () => sindex == stack.stack.length - 1;\r\n            });\r\n            this.hand.setOnClick(stack);\r\n        });\r\n    };\r\n\r\n    getCurrentAccepted = (index) => {\r\n        const currentFoundation = this.stacks[index].acceptedCards;\r\n        return currentFoundation[currentFoundation.length - 1];\r\n    };\r\n\r\n    wouldAcceptHand = (index) => !this.hand.hasMoreThanOneCard() && this.accepts(index, this.hand.currentCard());\r\n\r\n    putDownHand = (index) => this.add(index, this.hand.putDown());\r\n\r\n    accepts = (index, card) => {\r\n        const currentAccepted = this.getCurrentAccepted(index);\r\n        return this.stacks[index].icon == card.type.icon && currentAccepted == card.face;\r\n    };\r\n\r\n    add = (index, cards) => {\r\n        const card = cards[0];\r\n        card.causeEntropy(Math.min(this.settings.interactionEntropy, 3));\r\n        card.source = this.stacks[index].source;\r\n        this.stacks[index].stack.push(card);\r\n        return this.stacks[index].usedCards.push(this.stacks[index].acceptedCards.pop());\r\n    };\r\n\r\n    remove = (index, card) => {\r\n        this.stacks[index].acceptedCards.push(this.stacks[index].usedCards.pop());\r\n        return card && card.equals(this.getTop(index)) && this.stacks[index].stack.pop();\r\n    };\r\n\r\n    getPreviousUsed = (index) => [...this.stacks[index].usedCards].pop();\r\n\r\n    countCards = () => this.stacks.map((f) => parseInt(f.stack.length)).reduce((a, b) => a + b, 0);\r\n\r\n    getTop = (index) => this.stacks[index].stack[this.stacks[index].stack.length - 1];\r\n\r\n    static copy = (orig, hand) => {\r\n        const copy = new Foundation(orig.settings, hand);\r\n        copy.stacks = orig.stacks.map((origStack) => {\r\n            const s = new HandHoldingStack(origStack.source, hand);\r\n            s.stack = Card.copyAll(origStack.stack);\r\n            s.acceptedCards = [...origStack.acceptedCards];\r\n            s.usedCards = [...origStack.usedCards];\r\n            s.icon = origStack.icon;\r\n            s.color = origStack.color;\r\n            return s;\r\n        });\r\n        return copy;\r\n    };\r\n\r\n    setEntropy = (lvl) => {\r\n        this.stacks.forEach((stack) => stack.stack.forEach((element) => element.causeEntropy(Math.min(3, lvl))));\r\n        return this;\r\n    };\r\n}\r\n","import { BlinkFunction, ClickHandler } from \"../../Common\";\r\n\r\nimport Blinker from \"./Blinker\";\r\nimport Card from \"../Deck/Card\";\r\nimport Model from \"../Model\";\r\n\r\nexport default class Foundation implements ClickHandler {\r\n    blink: BlinkFunction = (state, index) => new Blinker().startBlink((s: Model) => s.foundation.stacks[index], state);\r\n\r\n    dispatchPutDown = (card: Card, position: any, state: Model, index: number) => {\r\n        if (state.foundation.wouldAcceptHand(index)) {\r\n            const src = state.hand.source;\r\n            state.foundation.putDownHand(index) && state.game.registerMove(\"foundation-\" + index, src);\r\n            this.tryDetectEnd(state);\r\n        } else {\r\n            this.blink(state, index);\r\n        }\r\n    };\r\n\r\n    dispatchPickup = (_card: Card, position: any, state: Model, index: number) => {\r\n        const card = state.foundation.getTop(index);\r\n        if (card && state.foundation.getPreviousUsed(index) === card.face) {\r\n            state.hand.pickUp([state.foundation.remove(index, card)], card.source, position) && state.game.registerPickup();\r\n        } else {\r\n            this.blink(state, index);\r\n        }\r\n    };\r\n\r\n    //@todo move this to a generic place, also detect failure\r\n    tryDetectEnd(state: Model) {\r\n        const nrofCards = state.foundation.countCards();\r\n        if (nrofCards === 52) {\r\n            state.game.isEnded = true;\r\n            state.game.end = Date.now();\r\n        }\r\n    }\r\n}\r\n","export default class Rating {\r\n    constructor(settings) {\r\n        this.settings = settings;\r\n        this.points = 0;\r\n        this.multiplicator = 1;\r\n    }\r\n\r\n    registerMove = (target, source) => {\r\n        this.registerHint(this.settings.disableHint());\r\n        const currentMove = {\r\n            source: source,\r\n            target: target,\r\n        };\r\n        this.points += this.rateMove(currentMove);\r\n    };\r\n\r\n    registerRecycle = () => {\r\n        this.registerHint(this.settings.disableHint());\r\n        if (this.settings.launchSettings.drawMode == \"single\" && this.settings.launchSettings.recyclingMode == \"infinite\") {\r\n            if (this.points > 0) {\r\n                if (this.points < 100) {\r\n                    this.points = 0;\r\n                } else {\r\n                    this.points -= 100;\r\n                }\r\n            }\r\n            console.debug(\"RATING: subtract (max) 100 points for RECYCLE\");\r\n        }\r\n    };\r\n\r\n    registerUncover = () => {\r\n        this.registerHint(this.settings.disableHint());\r\n        this.points += 5;\r\n        console.debug(\"RATING: add 5 points for UNCOVER\");\r\n    };\r\n\r\n    registerBlink(on) {\r\n        if (on && this.settings.launchSettings.missPenalty) {\r\n            this.points -= 10;\r\n            console.debug(\"RATING: subtract 10 points for invalid action\");\r\n        }\r\n    }\r\n\r\n    penalize = (other) => {\r\n        if (this.settings.launchSettings.undoPenalty) {\r\n            const penalty = Math.pow(2, other.multiplicator);\r\n            console.debug(`RATING: applying penalty of ${penalty} points for UNDO`);\r\n            this.points = Math.min(this.points, other.points) - penalty;\r\n            this.multiplicator = other.multiplicator + 1;\r\n        }\r\n    };\r\n\r\n    registerHint = (done) => {\r\n        if (done && this.settings.launchSettings.hintPenalty) {\r\n            this.points -= 10;\r\n            console.debug(`RATING: applying penalty of 10 points for HINT`);\r\n        }\r\n    };\r\n\r\n    rateMove(move) {\r\n        const isTableau = (obj) => obj.substr(0, 7) == \"tableau\";\r\n        const isFoundation = (obj) => obj.substr(0, 10) == \"foundation\";\r\n        if (isTableau(move.source)) {\r\n            if (isFoundation(move.target)) {\r\n                console.debug(\"RATING: add 10 points for MOVE tableau -> foundation\");\r\n                return 10;\r\n            }\r\n        } else if (move.source == \"waste\") {\r\n            if (isFoundation(move.target)) {\r\n                console.debug(\"RATING: add 10 points for MOVE waste -> foundation\");\r\n                return 10;\r\n            }\r\n            if (isTableau(move.target)) {\r\n                console.debug(\"RATING: add 5 points for MOVE waste -> tableau\");\r\n                return 5;\r\n            }\r\n        } else if (isFoundation(move.source)) {\r\n            if (isTableau(move.target)) {\r\n                console.debug(\"RATING: subtract 15 points for MOVE foundation -> tableau\");\r\n                return -15;\r\n            }\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n    getTimePenalty = (start, end) => {\r\n        const secondsToFinish = (end - start) / 1000;\r\n        return Math.trunc(secondsToFinish / 5) * -2;\r\n    };\r\n\r\n    getBonusPoints = (start, end) => {\r\n        const secondsToFinish = (end - start) / 1000;\r\n        if (secondsToFinish < 30) {\r\n            return 0;\r\n        }\r\n        return Math.round((20000 / secondsToFinish) * 35);\r\n    };\r\n\r\n    getTotal = (start, end) => {\r\n        return this.points + this.getBonusPoints(start, end) - this.getTimePenalty(start, end);\r\n    }\r\n\r\n    static copy = (orig) => {\r\n        const copy = new Rating(orig.settings);\r\n        copy.points = orig.points;\r\n        copy.multiplicator = orig.multiplicator;\r\n        return copy;\r\n    };\r\n}\r\n","import Card from \"../Deck/Card\";\r\n\r\nexport default class TimeMachine {\r\n    constructor() {\r\n        this.previousStates = [];\r\n        this.memorable = true;\r\n        this.modified = false;\r\n    }\r\n\r\n    registerMove = (target, source) => {\r\n        this.memorable = true;\r\n        this.modified = true;\r\n\r\n        if (source == target) {\r\n            this.memorable = false;\r\n        }\r\n    };\r\n\r\n    pushPreviousState = (state) => {\r\n        const previous = this.previousStates[this.previousStates.length - 1];\r\n        if (!previous || !this.modelEquals(state, previous)) {\r\n            this.previousStates.push(state);\r\n        }\r\n    };\r\n\r\n    registerPickup = () => {\r\n        this.modified = true;\r\n        this.memorable = false;\r\n    };\r\n\r\n    popPreviousState = (id, current) => {\r\n        const isRequested = this.previousStates.length - 1 == id;\r\n        const popPrevious = () => isRequested && this.previousStates && this.previousStates.pop();\r\n        let previous = popPrevious();\r\n        while (previous && (!previous.game.timemachine.memorable || this.modelEquals(previous, current)) && this.previousStates.length) {\r\n            previous = popPrevious();\r\n        }\r\n        return previous;\r\n    };\r\n\r\n    registerRecycle = () => {\r\n        this.memorable = true;\r\n        this.modified = true;\r\n    };\r\n\r\n    registerUncover = () => {\r\n        this.memorable = true;\r\n        this.modified = true;\r\n        return true;\r\n    };\r\n\r\n    registerBlink() {\r\n        this.modified = true;\r\n        this.memorable = false;\r\n    }\r\n\r\n    stackEquals = (a, b) => {\r\n        return a.stack.every((card, i) => Card.equals(card, b.stack[i]) && card.isHidden == b.stack[i].isHidden);\r\n    };\r\n\r\n    stacksEqual = (a, b) => {\r\n        return a.stacks.every((stack, i) => this.stackEquals(stack, b.stacks[i]));\r\n    };\r\n\r\n    modelEquals = (a, b) => {\r\n        return (\r\n            this.stackEquals(a.stock, b.stock) &&\r\n            this.stackEquals(a.waste, b.waste) &&\r\n            this.stacksEqual(a.tableau, b.tableau) &&\r\n            this.stacksEqual(a.foundation, b.foundation)\r\n        );\r\n    };\r\n\r\n    static copy = (orig) => {\r\n        const copy = new TimeMachine();\r\n        copy.previousStates = [...orig.previousStates];\r\n        copy.memorable = orig.memorable;\r\n        copy.modified = orig.modified;\r\n        return copy;\r\n    };\r\n}\r\n","import Rating from \"./Rating\";\r\nimport TimeMachine from \"./TimeMachine\";\r\n\r\nexport default class Game {\r\n    constructor(settings) {\r\n        this.settings = settings;\r\n        this.rating = new Rating(settings);\r\n        this.timemachine = new TimeMachine();\r\n        //@todo move to context:\r\n        this.started = 0;\r\n        this.isEnded = false;\r\n        this.end = 0;\r\n    }\r\n\r\n    registerMove = (target, source) => {\r\n        this.rating.registerMove(target, source);\r\n        this.timemachine.registerMove(target, source);\r\n        return true;\r\n    };\r\n\r\n    registerPickup = () => {\r\n        this.timemachine.registerPickup();\r\n        return true;\r\n    };\r\n\r\n    registerRecycle = () => {\r\n        this.rating.registerRecycle();\r\n        this.timemachine.registerRecycle();\r\n        return true;\r\n    };\r\n\r\n    registerUncover = () => {\r\n        this.rating.registerUncover();\r\n        this.timemachine.registerUncover();\r\n        return true;\r\n    };\r\n\r\n    registerBlink(on) {\r\n        this.rating.registerBlink(on);\r\n        this.timemachine.registerBlink(on);\r\n        return true;\r\n    }\r\n\r\n    static copy = (orig) => {\r\n        const copy = new Game(orig.settings);\r\n        copy.timemachine = TimeMachine.copy(orig.timemachine);\r\n        copy.rating = Rating.copy(orig.rating);\r\n        copy.paused = orig.paused;\r\n        return copy;\r\n    };\r\n}\r\n","import Card from \"../Deck/Card\";\r\nimport { IStack } from \"./IStack\";\r\nimport { XY } from \"../../View/UI/XY\";\r\n\r\nexport default class Hand {\r\n    stack: Card[];\r\n    source: string;\r\n    position: XY | null;\r\n    constructor() {\r\n        this.stack = [];\r\n        this.source = \"\";\r\n        this.position = null;\r\n    }\r\n\r\n    pickUp = (stack: Card[], source: string, position: XY) => {\r\n        if (stack && stack[0]) {\r\n            this.stack = stack.map((c) => {\r\n                c.suggestion = false;\r\n                return c;\r\n            });\r\n            this.source = source;\r\n            this.position = position;\r\n        }\r\n\r\n        return stack;\r\n    };\r\n\r\n    putDown = () => {\r\n        this.source = \"\";\r\n        const result = this.stack.splice(0, this.stack.length);\r\n        return result;\r\n    };\r\n\r\n    setOnClick = (model: IStack) => {\r\n        if (this.source && this.source == model.source) {\r\n            let _onClick = model.clickEmpty;\r\n            if (model.stack.length) {\r\n                _onClick = model.stack[model.stack.length - 1].onClick;\r\n            }\r\n            this.stack.forEach((card) => {\r\n                card.onClick = _onClick;\r\n                card.canClick = () => true;\r\n            });\r\n        }\r\n    };\r\n\r\n    isHoldingCard = () => !!this.stack.length;\r\n\r\n    isHoldingKing = () => this.isHoldingCard() && this.currentCard() && this.currentCard()?.face == \"K\";\r\n\r\n    currentCard: () => Card | null = () => (this.isHoldingCard() && this.stack[0]) || null;\r\n\r\n    hasMoreThanOneCard = () => this.stack.length > 1;\r\n\r\n    isFromCurrentSource = (card: Card) => (this.source && card.source == this.source) || null;\r\n\r\n    isFromWaste = () => this.source && this.source == \"waste\";\r\n\r\n    isFromFoundation = (index: number) => this.source && this.source == `foundation-${index}`;\r\n\r\n    isFromTableau = (index: number) => this.source && this.source == `tableau-${index}`;\r\n\r\n    isFromAnyTableau = () => this.source && this.source.substring(0, 8) == \"tableau-\";\r\n\r\n    getTableauIndex: () => number = () => (this.source && parseInt(this.source.substring(8))) || 0;\r\n\r\n    static copy = (orig: Hand) => {\r\n        const copy = new Hand();\r\n        copy.stack = Card.copyAll(orig.stack);\r\n        copy.source = orig.source;\r\n        copy.position = orig.position;\r\n        return copy;\r\n    };\r\n}\r\n","import Card from \"../Deck/Card\";\r\nimport { IStack } from \"../Game/IStack\";\r\nimport Model from \"../Model\";\r\n\r\ninterface NavIndex {\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n}\r\n\r\nexport default class Navigator {\r\n    model: Model;\r\n    currentIndex: NavIndex;\r\n    rows: IStack[][];\r\n    constructor(model: Model) {\r\n        this.model = model;\r\n        this.currentIndex = { x: 0, y: 0, z: 0 };\r\n        this.rows = [[this.model.stock, this.model.waste, undefined, ...this.model.foundation.stacks], [...this.model.tableau.stacks]];\r\n    }\r\n\r\n    getZindex = (elem: IStack, card: Card) => {\r\n        const targets = elem.getClickable();\r\n        for (let i = 0; i < targets.length; i++) {\r\n            if (Card.equals(card, targets[i])) {\r\n                return i;\r\n            }\r\n        }\r\n        return 0;\r\n    };\r\n\r\n    update = (pos: string, card: Card) => {\r\n        for (let i = 0; i < this.rows.length; i++) {\r\n            const row = this.rows[i];\r\n            for (let j = 0; j < row.length; j++) {\r\n                const elem = row[j];\r\n                if (elem && elem.source == pos) {\r\n                    const zIndex = this.getZindex(elem, card);\r\n                    this.currentIndex = { x: j, y: i, z: zIndex };\r\n                    this.finishNav();\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    valid = (pos: NavIndex) => pos.x === this.currentIndex.x && pos.y === this.currentIndex.y && pos.z === this.currentIndex.z;\r\n\r\n    moveLeft = (pos: NavIndex) =>\r\n        this.move(pos, () => {\r\n            this.currentIndex.x--;\r\n            if (this.currentIndex.x == -1) {\r\n                this.currentIndex.x = 6;\r\n            }\r\n        });\r\n\r\n    moveRight = (pos: NavIndex) =>\r\n        this.move(pos, () => {\r\n            this.currentIndex.x++;\r\n            if (this.currentIndex.x == 7) {\r\n                this.currentIndex.x = 0;\r\n            }\r\n        });\r\n\r\n    move = (pos: NavIndex, direction: () => void) => {\r\n        if (!this.valid(pos)) {\r\n            return;\r\n        }\r\n        direction();\r\n        if (this.current() == undefined) {\r\n            this.move(this.currentIndex, direction);\r\n        } else {\r\n            this.currentIndex.z = this.current().getClickable().length - 1;\r\n            this.finishNav();\r\n        }\r\n    };\r\n\r\n    moveUp = (pos: NavIndex) => {\r\n        if (!this.valid(pos)) {\r\n            return;\r\n        }\r\n        const clickable = this.current().getClickable();\r\n        if (clickable.length && this.currentIndex.z > 0) {\r\n            this.currentIndex.z--;\r\n            this.finishNav();\r\n        } else {\r\n            this.toggleRow(true);\r\n        }\r\n    };\r\n\r\n    moveDown = (pos: NavIndex) => {\r\n        if (!this.valid(pos)) {\r\n            return;\r\n        }\r\n        const clickable = this.current().getClickable();\r\n        if (clickable.length && this.currentIndex.z < clickable.length - 1) {\r\n            this.currentIndex.z++;\r\n            this.finishNav();\r\n        } else {\r\n            this.toggleRow(false);\r\n        }\r\n    };\r\n\r\n    toggleRow = (pickLast: boolean) => {\r\n        if (this.currentIndex.y == 0) {\r\n            this.currentIndex.y = 1;\r\n        } else {\r\n            this.currentIndex.y = 0;\r\n        }\r\n        const last = this.current() ? this.current().getClickable().length - 1 : 0;\r\n        this.currentIndex.z = pickLast ? last : 0;\r\n        if (this.current() == undefined) {\r\n            this.moveLeft(this.currentIndex);\r\n        } else {\r\n            this.finishNav();\r\n        }\r\n    };\r\n\r\n    finishNav = () => {\r\n        const clickable = this.current().getClickable();\r\n        if (clickable && clickable[this.currentIndex.z]) {\r\n            this.model.focus.setCard(clickable[this.currentIndex.z]);\r\n        } else {\r\n            this.model.focus.setStack(this.current().source);\r\n        }\r\n        return true;\r\n    };\r\n\r\n    current = () => {\r\n        return this.rows[this.currentIndex.y][this.currentIndex.x];\r\n    };\r\n\r\n    pressCurrent = () => {\r\n        if (this.model.focus.card && this.model.focus.card.canClick()) {\r\n            return this.model.focus.card.onClick({ isKeyboard: true });\r\n        } else if (this.model.focus.stack) {\r\n            console.debug(\"delegating to clickempty\");\r\n            return this.current().clickEmpty({ isKeyboard: true });\r\n        } else {\r\n            return (ctx: Model) => {\r\n                ctx.navigator.finishNav();\r\n                ctx.game.timemachine.modified = true;\r\n            };\r\n        }\r\n    };\r\n}\r\n","import SuggestionModes, { SuggestionMode } from \"./Settings/SuggestionModes\";\r\n\r\nimport { LaunchSettings } from \"../../Common\";\r\n\r\nexport default class Settings {\r\n    launchSettings: LaunchSettings;\r\n    baseEntropy: number;\r\n    interactionEntropy: number;\r\n    suggestionModes: SuggestionMode[];\r\n    suggestionMode: SuggestionMode;\r\n\r\n    constructor(launchSettings: LaunchSettings) {\r\n        this.launchSettings = launchSettings;\r\n        this.baseEntropy = launchSettings.baseEntropy;\r\n        this.interactionEntropy = launchSettings.interactionEntropy;\r\n        this.suggestionModes = SuggestionModes.allSuggestionModes();\r\n        this.suggestionMode = SuggestionModes.get(launchSettings.suggestionMode);\r\n    }\r\n\r\n    setSuggestionMode = (sm: string) => {\r\n        if (this.suggestionMode.key !== sm) {\r\n            this.suggestionMode = SuggestionModes.get(sm);\r\n        }\r\n    };\r\n\r\n    enableHint = () => {\r\n        this.suggestionMode = SuggestionModes.getHintMode();\r\n    };\r\n\r\n    disableHint = () => {\r\n        if (this.suggestionMode.isTemporary && this.suggestionMode.next) {\r\n            this.suggestionMode = SuggestionModes.get(this.suggestionMode.next);\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    static copy = (orig: Settings) => {\r\n        const copy = new Settings(orig.launchSettings);\r\n        copy.suggestionMode = orig.suggestionMode;\r\n        copy.baseEntropy = orig.baseEntropy;\r\n        copy.interactionEntropy = orig.interactionEntropy;\r\n        return copy;\r\n    };\r\n}\r\n","import BasicStack from \"./BasicStack\";\r\nimport Card from \"../Deck/Card\";\r\n\r\nexport default class Stock extends BasicStack {\r\n    constructor(stack, settings) {\r\n        super(\"stock\");\r\n        this.settings = settings;\r\n        this.stack = stack.map(this.setCardProperties);\r\n        this.recyclings = 0;\r\n        this.passes = -1;\r\n        // eslint-disable-next-line no-unused-vars\r\n        this.blinkFor = 0;\r\n        this.unblink = () => {};\r\n        if (this.settings.launchSettings.recyclingMode == \"1-pass\") {\r\n            this.passes = 1;\r\n        }\r\n        if (this.settings.launchSettings.recyclingMode == \"3-pass\") {\r\n            this.passes = 3;\r\n        }\r\n    }\r\n\r\n    setOnClick = (onClick) => {\r\n        this.clickEmpty = (p) => onClick(null, p);\r\n        this.stack.forEach((card, index) => {\r\n            card.onClick = (p) => onClick({ ...card }, p);\r\n            card.canClick = () => index == this.stack.length - 1;\r\n        });\r\n    };\r\n\r\n    popOne = () => {\r\n        const result = this.stack.pop();\r\n        return result;\r\n    };\r\n\r\n    canRecycle() {\r\n        return (\r\n            this.settings.launchSettings.recyclingMode == \"infinite\" ||\r\n            (this.settings.launchSettings.recyclingMode == \"3-pass\" && this.recyclings < 2)\r\n        );\r\n    }\r\n\r\n    recycle = (waste) => {\r\n        if (waste.length) {\r\n            this.stack = waste.reverse().map(this.setCardProperties);\r\n            this.stack[this.stack.length - 1].canClick = () => true;\r\n            this.recyclings++;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    setCardProperties = (card) => {\r\n        card.causeEntropy(Math.min(this.settings.interactionEntropy, 1));\r\n        card.isHidden = true;\r\n        card.source = this.source;\r\n        return card;\r\n    };\r\n\r\n    isOnTop = (card) => card && card.equals(this.getTop());\r\n\r\n    popTop = () => {\r\n        let result = [];\r\n        if (this.settings.launchSettings.drawMode == \"single\") {\r\n            result = [this.stack.pop()];\r\n        }\r\n        if (this.settings.launchSettings.drawMode == \"triple\") {\r\n            result = this.stack.splice(this.stack.length - 3);\r\n        }\r\n        if (this.stack.length == 0) {\r\n            this.passes--;\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    static copy = (orig) => {\r\n        const copy = new Stock([], orig.settings, orig.focus);\r\n        copy.stack = Card.copyAll(orig.stack);\r\n        copy.dealt = orig.dealt;\r\n        copy.dealingAt = orig.dealingAt;\r\n        copy.isDealt = orig.isDealt;\r\n        copy.passes = orig.passes;\r\n        copy.recyclings = orig.recyclings;\r\n        return copy;\r\n    };\r\n\r\n    setEntropy = (lvl) => {\r\n        this.stack.forEach((element) => element.causeEntropy(Math.min(lvl, 1)));\r\n        return this;\r\n    };\r\n}\r\n","import { BlinkFunction, ClickHandler } from \"../../Common\";\r\n\r\nimport Blinker from \"./Blinker\";\r\nimport Card from \"../Deck/Card\";\r\nimport Model from \"../Model\";\r\nimport Navigator from \"./Navigator\";\r\n\r\nexport default class Stock implements ClickHandler {\r\n    navigator: Navigator;\r\n    constructor(navigator: Navigator) {\r\n        this.navigator = navigator;\r\n    }\r\n\r\n    blink: BlinkFunction = (state: Model) => new Blinker().startBlink((s: Model) => s.stock, state);\r\n\r\n    dispatchPutDown = (_card: Card, _position: any, state: Model) => this.blink(state, 0);\r\n\r\n    dispatchPickup = (card: Card, _position: any, state: Model) => {\r\n        return card != null ? this.moveToWaste(card, state) : this.recycleWaste(card, state);\r\n    };\r\n\r\n    moveToWaste = (card: Card, state: Model) => {\r\n        return state.stock.isOnTop(card) && state.waste.addAll(state.stock.popTop()) && state.game.registerMove(\"waste\", \"stock\");\r\n    };\r\n\r\n    recycleWaste = (_card: Card, state: Model) => {\r\n        if (!state.stock.getTop()) {\r\n            return (\r\n                (!!state.waste.getTop() &&\r\n                    state.stock.canRecycle() &&\r\n                    state.stock.recycle(state.waste.recycle()) &&\r\n                    state.game.registerRecycle() &&\r\n                    this.navigator.finishNav()) ||\r\n                this.blink(state, 0)\r\n            );\r\n        }\r\n    };\r\n}\r\n","import { BlinkFunction, ClickHandler } from \"../../Common\";\r\n\r\nimport Blinker from \"./Blinker\";\r\nimport Card from \"../Deck/Card\";\r\nimport Model from \"../Model\";\r\n\r\nexport default class Waste implements ClickHandler {\r\n    blink: BlinkFunction = (state: Model) => new Blinker().startBlink((s: Model) => s.waste, state);\r\n\r\n    dispatchPutDown = (card: Card, position: any, state: Model) =>\r\n        (state.waste.wouldAcceptHand() && state.waste.putDownHand() && state.game.registerMove(\"waste\", \"waste\")) || this.blink(state, 0);\r\n\r\n    dispatchPickup = (card: Card, position: any, state: Model) =>\r\n        (card && state.hand.pickUp([state.waste.popTop(card)], \"waste\", position) && state.game.registerPickup()) || this.blink(state, 0);\r\n}\r\n","import Model from \"../Model\";\r\nimport SuggestionModes from \"../Game/Settings/SuggestionModes\";\r\nimport Tableau from \"./Tableau\";\r\nimport Waste from \"./Waste\";\r\n\r\nexport default class Suggestions {\r\n    tableau: Tableau;\r\n    waste: Waste;\r\n\r\n    constructor() {\r\n        this.tableau = new Tableau();\r\n        this.waste = new Waste();\r\n    }\r\n\r\n    evaluateOptions = (state: Model) => {\r\n        this.disableAllSuggestions(state);\r\n        if (\r\n            state.settings.suggestionMode.key !== SuggestionModes.NONE &&\r\n            !this.getUncoverOptions(state) &&\r\n            !this.getPutdownSuggestions(state) &&\r\n            !state.hand.isHoldingCard() &&\r\n            (!this.getPickupOptions(state) || state.settings.suggestionMode.key == SuggestionModes.FULL) &&\r\n            (state.stock.getTop() || state.stock.canRecycle()) &&\r\n            state.settings.suggestionMode.key !== SuggestionModes.SCORED\r\n        ) {\r\n            state.stock.suggestion = true;\r\n        }\r\n    };\r\n\r\n    getPutdownSuggestions = (state: Model, onlyUseful?: boolean) => {\r\n        if (!state.hand.isHoldingCard() || state.settings.suggestionMode.key == SuggestionModes.NONE) {\r\n            return 0;\r\n        }\r\n\r\n        const accepted = [];\r\n        if (state.waste.wouldAcceptHand()) {\r\n            if (state.settings.suggestionMode.key === SuggestionModes.FULL || !state.hand.isFromWaste()) {\r\n                const move = { target: \"waste\", source: state.hand.source };\r\n                if (state.settings.suggestionMode.key !== SuggestionModes.SCORED || state.game.rating.rateMove(move) > 0) {\r\n                    accepted.push(move);\r\n                    state.waste.suggestion = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        state.foundation.stacks.forEach((stack, index) => {\r\n            if (state.foundation.wouldAcceptHand(index)) {\r\n                if (state.settings.suggestionMode.key === SuggestionModes.FULL || !state.hand.isFromFoundation(index)) {\r\n                    const move = { target: stack.source, source: state.hand.source };\r\n                    if (state.settings.suggestionMode.key !== SuggestionModes.SCORED || state.game.rating.rateMove(move) > 0) {\r\n                        accepted.push(move);\r\n                        stack.suggestion = true;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        state.tableau.stacks.forEach((stack, index) => {\r\n            if (state.tableau.wouldAcceptHand(index)) {\r\n                if (state.settings.suggestionMode.key === SuggestionModes.FULL || !state.hand.isFromTableau(index)) {\r\n                    const isMoveOfKingBetweenEmptySlots =\r\n                        state.hand.isHoldingKing() &&\r\n                        stack.stack.length == 0 &&\r\n                        state.hand.isFromAnyTableau() &&\r\n                        state.tableau.stacks[state.hand.getTableauIndex()].stack.length == 0;\r\n\r\n                    const isMoveBetweenSimilarParentCards =\r\n                        stack.stack.length > 0 &&\r\n                        state.hand.isFromAnyTableau() &&\r\n                        state.tableau.stacks[state.hand.getTableauIndex()].stack.length > 0 &&\r\n                        stack.stack[stack.stack.length - 1].face ==\r\n                            state.tableau.stacks[state.hand.getTableauIndex()].stack[\r\n                                state.tableau.stacks[state.hand.getTableauIndex()].stack.length - 1\r\n                            ].face &&\r\n                        !state.tableau.getTop(state.hand.getTableauIndex()).isHidden;\r\n\r\n                    const isNotLoop = !isMoveOfKingBetweenEmptySlots && !isMoveBetweenSimilarParentCards;\r\n\r\n                    if (!onlyUseful || state.settings.suggestionMode.key === SuggestionModes.FULL || isNotLoop) {\r\n                        const move = { target: stack.source, source: state.hand.source };\r\n                        if (state.settings.suggestionMode.key !== SuggestionModes.SCORED || state.game.rating.rateMove(move) > 0) {\r\n                            accepted.push(move);\r\n                            stack.suggestion = true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        return accepted.length;\r\n    };\r\n\r\n    getPickupOptions = (state: Model) => {\r\n        let foundAny = false;\r\n        const wasteState = Model.copy(state);\r\n        this.waste.dispatchPickup(wasteState.waste.getTop(), null, wasteState);\r\n        if (wasteState.game.timemachine.modified) {\r\n            if (this.getPutdownSuggestions(wasteState, true) > (state.settings.suggestionMode.key == SuggestionModes.FULL ? 1 : 0)) {\r\n                state.waste.suggestion = true;\r\n                foundAny = true;\r\n            }\r\n        }\r\n\r\n        state.tableau.stacks.forEach((tableau, index) =>\r\n            tableau.stack\r\n                .map((card, cardIndex) => ({ cardIndex, card }))\r\n                .filter(({ card }) => !card.isHidden)\r\n                .forEach(({ card, cardIndex }) => {\r\n                    const tableauState = Model.copy(state);\r\n                    this.tableau.dispatchPickup(card, null, tableauState, index);\r\n                    if (tableauState.game.timemachine.modified) {\r\n                        if (this.getPutdownSuggestions(tableauState, true) > (state.settings.suggestionMode.key == SuggestionModes.FULL ? 1 : 0)) {\r\n                            tableau.stack[cardIndex].suggestion = true;\r\n                            foundAny = true;\r\n                        }\r\n                    }\r\n                })\r\n        );\r\n        return foundAny;\r\n    };\r\n\r\n    getUncoverOptions = (state: Model) => {\r\n        if (!state.hand.isHoldingCard()) {\r\n            const filtered = state.tableau.stacks\r\n                .map((_stack, index) => index)\r\n                .filter((index) => state.tableau.getTop(index) && state.tableau.getTop(index).isHidden);\r\n            filtered.forEach((index) => {\r\n                state.tableau.getTop(index).suggestion = true;\r\n            });\r\n            return filtered.length;\r\n        }\r\n\r\n        return 0;\r\n    };\r\n\r\n    disableAllSuggestions = (state: Model) => {\r\n        const disableSuggestion = (obj: any) => {\r\n            obj.suggestion = false;\r\n            obj.stack && obj.stack.forEach(disableSuggestion);\r\n            obj.stacks && obj.stacks.forEach(disableSuggestion);\r\n        };\r\n\r\n        disableSuggestion(state.waste);\r\n        disableSuggestion(state.stock);\r\n        disableSuggestion(state.tableau);\r\n        disableSuggestion(state.foundation);\r\n    };\r\n}\r\n","import Card from \"../Deck/Card\";\r\nimport Hand from \"./Hand\";\r\nimport HandHoldingStack from \"./HandHoldingStack\";\r\nimport { IStack } from \"./IStack\";\r\nimport Settings from \"./Settings\";\r\nimport { getTableauOrder } from \"../Deck/DeckSize\";\r\n\r\nclass TableauStack extends HandHoldingStack implements IStack {\r\n    blinkFor = 0;\r\n    id = 0;\r\n    // eslint-disable-next-line no-unused-vars\r\n    onClick = (a: any) => {};\r\n    // eslint-disable-next-line no-unused-vars\r\n    clickEmpty = (a: any) => {};\r\n    setOnClick = () => {};\r\n}\r\nexport default class Tableau {\r\n    stacks: TableauStack[];\r\n    settings: Settings;\r\n    hand: Hand;\r\n\r\n    constructor(settings: Settings, hand: Hand) {\r\n        const ids = [0, 1, 2, 3, 4, 5, 6];\r\n        this.hand = hand;\r\n        this.stacks = ids.map((id) => {\r\n            const s = new TableauStack(\"tableau-\" + id, hand);\r\n            s.stack = [];\r\n            s.blinkFor = 0;\r\n            s.id = id;\r\n            return s;\r\n        });\r\n        this.settings = settings;\r\n    }\r\n\r\n    setOnClick = (onClick: (a: any, b: any, index: number) => void, onClickhidden: (a: any, b: any, index: number) => void, hand: Hand) => {\r\n        this.stacks.forEach((stack, index) => {\r\n            stack.clickEmpty = (p: any) => onClick(null, p, index);\r\n            stack.stack.forEach((card, sindex) => {\r\n                const click = card.isHidden && sindex == stack.stack.length - 1 ? onClickhidden : onClick;\r\n                card.onClick = (p: any) => click({ ...card }, p, index);\r\n                card.canClick = () => !card.isHidden || this.canUncover(index, card);\r\n            });\r\n            hand.setOnClick(stack);\r\n        });\r\n    };\r\n\r\n    getStack = (index: number) => this.stacks[index];\r\n\r\n    wouldAcceptHand = (index: number) => this.canPutDown(this.getTop(index), this.hand, index);\r\n\r\n    putDownHand = (index: number) => this.add(index, this.hand.putDown());\r\n\r\n    canPutDown = (card: Card, hand: Hand, index: number) =>\r\n        (card && card.isHidden && hand.isFromCurrentSource(card)) ||\r\n        this.accepts(index, hand.currentCard()) ||\r\n        (!card && hand.isFromTableau(index));\r\n\r\n    accepts = (index: number, current?: Card | null) => {\r\n        const top = this.getTop(index);\r\n        if (!top) {\r\n            return current && current.face === \"K\";\r\n        }\r\n        if (top.isHidden) {\r\n            return false;\r\n        }\r\n        const range = [...getTableauOrder()];\r\n        const currentIndex = range.indexOf(current?.face);\r\n        const topIndex = range.indexOf(top.face);\r\n        return currentIndex + 1 == topIndex && current?.type.color !== top.type.color && top.face !== \"A\";\r\n    };\r\n\r\n    getCard = (index: number, card: Card) => {\r\n        for (let j = 0; j < this.stacks[index].stack.length; j++) {\r\n            if (card && card.equals(this.stacks[index].stack[j]) && card.isHidden === this.stacks[index].stack[j].isHidden) {\r\n                return this.stacks[index].stack[j];\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    popWithFollowing = (card: Card, i: number) => {\r\n        for (let j = 0; j < this.stacks[i].stack.length; j++) {\r\n            if (card && card.equals(this.stacks[i].stack[j])) {\r\n                const result = this.stacks[i].stack.splice(j, this.stacks[i].stack.length);\r\n                this.stackEntropy(i);\r\n                return result;\r\n            }\r\n        }\r\n\r\n        return [];\r\n    };\r\n\r\n    deal = (card: Card, index: number) => {\r\n        this.stacks[index].stack.push(card);\r\n    };\r\n\r\n    canUncover = (index: number, card: Card) => {\r\n        const top = this.getTop(index);\r\n        return top.isHidden && card && card.equals(this.getTop(index));\r\n    };\r\n\r\n    uncover = (index: number, card: Card) => {\r\n        const top = this.getTop(index);\r\n        if (this.canUncover(index, card)) {\r\n            top.isHidden = false;\r\n            this.stackEntropy(index);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    stackEntropy = (index: number) => {\r\n        let entropy = this.settings.interactionEntropy;\r\n        let next = 1;\r\n        let top = this.getTop(index);\r\n        while (entropy && entropy != 0 && top) {\r\n            top.causeEntropy(entropy);\r\n            entropy--;\r\n            top = this.getTop(index, next);\r\n            next++;\r\n        }\r\n    };\r\n\r\n    add = (index: number, cards: Card[]) => {\r\n        this.stacks[index].stack = this.stacks[index].stack.concat(cards.map((c) => this.setCardProperties(c, index)));\r\n        this.stackEntropy(index);\r\n        return cards;\r\n    };\r\n\r\n    setCardProperties = (card: Card, index: number) => {\r\n        card.source = this.stacks[index].source;\r\n        return card;\r\n    };\r\n\r\n    getTop = (index: number, offset?: number) => this.stacks[index].stack[this.stacks[index].stack.length - 1 - (offset || 0)];\r\n\r\n    static copy = (orig: Tableau, hand: Hand) => {\r\n        const copy = new Tableau(orig.settings, hand);\r\n        copy.stacks = orig.stacks.map((stack, index) => {\r\n            const s = new TableauStack(stack.source, hand);\r\n            s.id = index;\r\n            s.stack = Card.copyAll(stack.stack);\r\n            return s;\r\n        });\r\n        return copy;\r\n    };\r\n\r\n    setEntropy = (lvl: number) => {\r\n        this.stacks.forEach((stack) => stack.stack.forEach((element) => element.causeEntropy(Math.min(lvl, 4))));\r\n        return this;\r\n    };\r\n}\r\n","import Card from \"../Deck/Card\";\r\nimport HandHoldingStack from \"./HandHoldingStack\";\r\n\r\nexport default class Waste extends HandHoldingStack {\r\n    constructor(settings, hand) {\r\n        super(\"waste\", hand);\r\n        this.settings = settings;\r\n        // eslint-disable-next-line no-unused-vars\r\n        this.blinkFor = 0;\r\n        this.unblink = () => {};\r\n    }\r\n\r\n    setOnClick = (onClick) => {\r\n        this.clickEmpty = (p) => onClick(null, p);\r\n        this.stack.forEach((card, index) => {\r\n            card.onClick = (p) => onClick({ ...card }, p);\r\n            card.canClick = () => index == this.stack.length - 1;\r\n        });\r\n        this.hand.setOnClick(this);\r\n    };\r\n\r\n    putDownHand = () => this.addAll(this.hand.putDown());\r\n\r\n    add = (card) => card && this.stack.push(this.setCardProperties(card));\r\n\r\n    addAll = (cards) => cards && cards.length && cards.map(this.add);\r\n\r\n    setCardProperties = (card) => {\r\n        card.source = this.source;\r\n        card.isHidden = false;\r\n        card.causeEntropy(Math.min(this.settings.interactionEntropy, 1));\r\n        return card;\r\n    };\r\n\r\n    wouldAcceptHand = () => this.hand.isFromWaste() && this.canAdd(this.hand.currentCard());\r\n\r\n    canAdd = (card) => card && (!this.getTop() || !card.equals(this.getTop()));\r\n\r\n    popTop = (card) => card && card.equals(this.getTop()) && this.stack.pop();\r\n\r\n    recycle = () => this.stack.splice(0, this.stack.length);\r\n\r\n    static copy = (orig, hand) => {\r\n        const copy = new Waste(orig.settings, hand);\r\n        copy.stack = Card.copyAll(orig.stack);\r\n        return copy;\r\n    };\r\n\r\n    setEntropy = (lvl) => {\r\n        this.stack.forEach((element) => element.causeEntropy(Math.min(lvl, 1)));\r\n        return this;\r\n    };\r\n}\r\n","import { ClickHandler, LaunchSettings } from \"../Common\";\r\nimport TableauHandler, { TableauHidden } from \"./Business/Tableau\";\r\n\r\nimport Dealer from \"./Business/Dealer\";\r\nimport Deck from \"./Deck/Deck\";\r\nimport Dispatcher from \"./Business/Dispatcher\";\r\nimport Focus from \"./Game/Focus\";\r\nimport Foundation from \"./Game/Foundation\";\r\nimport FoundationHandler from \"./Business/Foundation\";\r\nimport Game from \"./Game/Game\";\r\nimport Hand from \"./Game/Hand\";\r\nimport Navigator from \"./Business/Navigator\";\r\nimport Settings from \"./Game/Settings\";\r\nimport Stock from \"./Game/Stock\";\r\nimport StockHandler from \"./Business/Stock\";\r\nimport Suggestions from \"./Business/Suggestions\";\r\nimport Tableau from \"./Game/Tableau\";\r\nimport Waste from \"./Game/Waste\";\r\nimport WasteHandler from \"./Business/Waste\";\r\n\r\nexport default class Model {\r\n    stock: Stock;\r\n    waste: Waste;\r\n    foundation: Foundation;\r\n    tableau: Tableau;\r\n    hand: Hand;\r\n    game: Game;\r\n    settings: Settings;\r\n    focus: Focus;\r\n    suggestor: Suggestions;\r\n    dealer: Dealer;\r\n    navigator: Navigator;\r\n\r\n    constructor(obj: any) {\r\n        this.stock = obj.stock;\r\n        this.waste = obj.waste;\r\n        this.foundation = obj.foundation;\r\n        this.tableau = obj.tableau;\r\n        this.hand = obj.hand;\r\n        this.game = obj.game;\r\n        this.settings = obj.settings;\r\n        this.focus = obj.focus;\r\n        this.suggestor = new Suggestions();\r\n        this.dealer = new Dealer();\r\n        this.navigator = new Navigator(this);\r\n    }\r\n\r\n    withSuggestions = () => {\r\n        this.suggestor.evaluateOptions(this);\r\n        return this;\r\n    };\r\n\r\n    setEntropy = (lvl: number) => {\r\n        this.settings.baseEntropy = lvl;\r\n        this.stock.setEntropy(lvl);\r\n        this.waste.setEntropy(lvl);\r\n        this.foundation.setEntropy(lvl);\r\n        this.tableau.setEntropy(lvl);\r\n    };\r\n\r\n    withHandlers = () => {\r\n        const getHandler = (clickHandler: ClickHandler) => new Dispatcher(clickHandler).getHandler(this.hand);\r\n        this.stock.setOnClick(getHandler(new StockHandler(this.navigator)));\r\n        this.waste.setOnClick(getHandler(new WasteHandler()));\r\n        this.foundation.setOnClick(getHandler(new FoundationHandler()));\r\n        this.tableau.setOnClick(getHandler(new TableauHandler()), getHandler(new TableauHidden()), this.hand);\r\n        return this;\r\n    };\r\n\r\n    static getInitialState = (launchSettings: LaunchSettings, deck: Deck) => {\r\n        const settings = new Settings(launchSettings);\r\n        const hand = new Hand();\r\n        const state = {\r\n            stock: new Stock([...deck.cards], settings),\r\n            waste: new Waste(settings, hand),\r\n            foundation: new Foundation(settings, hand),\r\n            tableau: new Tableau(settings, hand),\r\n            hand: hand,\r\n            game: new Game(settings),\r\n            settings: settings,\r\n            focus: new Focus(settings),\r\n        };\r\n        return new Model(state);\r\n    };\r\n\r\n    static copy = (state: Model) => {\r\n        const hand = Hand.copy(state.hand);\r\n        return new Model({\r\n            stock: Stock.copy(state.stock),\r\n            waste: Waste.copy(state.waste, hand),\r\n            foundation: Foundation.copy(state.foundation, hand),\r\n            tableau: Tableau.copy(state.tableau, hand),\r\n            hand: hand,\r\n            game: Game.copy(state.game),\r\n            settings: Settings.copy(state.settings),\r\n            focus: state.focus,\r\n        });\r\n    };\r\n}\r\n","import { LaunchSettings, StateReplacer, StateUpdater } from \"../../Common\";\r\n\r\nimport Board from \"./Board\";\r\nimport Deck from \"../../Model/Deck/Deck\";\r\nimport EndScreen from \"../UI/EndScreen\";\r\nimport Model from \"../../Model/Model\";\r\nimport { Provider } from \"../Context\";\r\nimport React from \"react\";\r\n\r\nexport const BoardContext = React.createContext({\r\n    player: 0,\r\n});\r\n\r\nconst BoardProvider = BoardContext.Provider;\r\n\r\ninterface BoardWrapProps {\r\n    settings: LaunchSettings;\r\n    restart: () => void;\r\n    deck: Deck;\r\n    player: number;\r\n}\r\n\r\nexport default class BoardWrap extends React.Component<BoardWrapProps, Model> {\r\n    constructor(props: BoardWrapProps) {\r\n        super(props);\r\n        this.state = Model.getInitialState(props.settings, props.deck);\r\n    }\r\n\r\n    //replacecontext is hard replacement, for restart and undo\r\n    replaceContext = (modifier: StateReplacer) => this.setState(modifier);\r\n\r\n    //updatecontext is soft replacement used for navigation.\r\n    updateContext = (modifier: StateUpdater) =>\r\n        this.replaceContext((state) => {\r\n            modifier(state);\r\n            return state;\r\n        });\r\n\r\n    //updateGameContext is for undo-able game actions\r\n    updateGameContext = (modifier: StateUpdater) =>\r\n        this.replaceContext((state) => {\r\n            state.game.timemachine.modified = false;\r\n            const previous = Model.copy(state);\r\n            modifier(state);\r\n            if (state.game.timemachine.modified) {\r\n                state.game.timemachine.pushPreviousState(previous);\r\n                return state;\r\n            }\r\n\r\n            return null;\r\n        });\r\n\r\n        //on every render, we refresh the click handlers in the model and the suggestions\r\n        //this is heavy - could it be done in updateGameContext? (and undo, and initial, and restart, and pause/unpause, well)\r\n    render = () => {\r\n        const context = {\r\n            state: this.state.withHandlers().withSuggestions(),\r\n            replaceContext: this.replaceContext,\r\n            updateContext: this.updateContext,\r\n            updateGameContext: this.updateGameContext,\r\n            restart: this.props.restart,\r\n        };\r\n        return (\r\n            <Provider value={context}>\r\n                <BoardProvider\r\n                    value={{\r\n                        player: this.props.player,\r\n                    }}\r\n                >\r\n                    <Board mode={this.props.settings.boardMode} />\r\n                </BoardProvider>\r\n                <EndScreen />\r\n            </Provider>\r\n        );\r\n    };\r\n}\r\n"],"sourceRoot":""}